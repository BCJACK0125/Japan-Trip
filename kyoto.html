<!doctype html>
<html lang="zh-Hant">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<meta name="theme-color" content="#2F4F4F" />
		<title>2026 äº¬é˜ªç¥è¡Œç¨‹å°å·¥å…·</title>
		<link rel="preconnect" href="https://fonts.googleapis.com" />
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
		<link
			href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+JP:wght@400;500;700&display=swap"
			rel="stylesheet"
		/>
		<style>
			:root {
				--ink: #2f4f4f;
				--bg: #f5f5f5;
				--card: #ffffff;
				--accent: #ff6b6b;
				--muted: rgba(47, 79, 79, 0.64);
				--line: rgba(47, 79, 79, 0.14);
				--shadow: 0 10px 28px rgba(47, 79, 79, 0.12);
				--radius: 16px;
			}

			* {
				box-sizing: border-box;
			}

			html,
			body {
				height: 100%;
			}

			body {
				margin: 0;
				font-family: Inter, "Noto Sans JP", system-ui, -apple-system, "SF Pro Text",
					"Segoe UI", Roboto, "Helvetica Neue", Arial, "PingFang TC", "Noto Sans TC",
					sans-serif;
				color: var(--ink);
				background: var(--bg);
				-webkit-font-smoothing: antialiased;
				text-rendering: optimizeLegibility;
			}

			/* Very subtle checkered (å¸‚æ¾) accent */
			.app {
				min-height: 100%;
				padding-bottom: 84px;
				background-image:
					linear-gradient(45deg, rgba(47, 79, 79, 0.03) 25%, transparent 25%),
					linear-gradient(-45deg, rgba(47, 79, 79, 0.03) 25%, transparent 25%),
					linear-gradient(45deg, transparent 75%, rgba(47, 79, 79, 0.03) 75%),
					linear-gradient(-45deg, transparent 75%, rgba(47, 79, 79, 0.03) 75%);
				background-size: 32px 32px;
				background-position: 0 0, 0 16px, 16px -16px, -16px 0;
			}

			.topbar {
				position: sticky;
				top: 0;
				z-index: 5;
				background: rgba(245, 245, 245, 0.88);
				backdrop-filter: blur(10px);
				border-bottom: 1px solid var(--line);
			}

			.topbar-inner {
				max-width: 560px;
				margin: 0 auto;
				padding: 14px 16px 10px;
			}

			.title {
				display: flex;
				align-items: baseline;
				justify-content: space-between;
				gap: 12px;
			}

			.title h1 {
				margin: 0;
				font-size: 18px;
				letter-spacing: 0.2px;
			}

			.subtitle {
				margin: 4px 0 0;
				font-size: 12px;
				color: var(--muted);
			}

			main {
				max-width: 560px;
				margin: 0 auto;
				padding: 16px;
			}

			.page {
				display: none;
			}

			.page[aria-hidden="false"] {
				display: block;
			}

			.day {
				margin: 14px 0 20px;
			}

			.day-header {
				background: var(--card);
				border: 1px solid var(--line);
				border-radius: var(--radius);
				box-shadow: var(--shadow);
				padding: 12px 12px;
				display: grid;
				gap: 10px;
			}

			.day-title {
				display: flex;
				align-items: flex-start;
				justify-content: space-between;
				gap: 12px;
			}

			.day-title .left {
				display: grid;
				gap: 4px;
			}

			.day-title .date {
				font-size: 15px;
				font-weight: 700;
			}

			.day-title .meta {
				font-size: 12px;
				color: var(--muted);
			}

			.weather {
				display: flex;
				align-items: center;
				justify-content: flex-end;
				gap: 10px;
			}

			.wx-icon {
				width: 34px;
				height: 34px;
				display: grid;
				place-items: center;
				border-radius: 10px;
				background: rgba(47, 79, 79, 0.06);
				border: 1px solid rgba(47, 79, 79, 0.08);
				font-size: 18px;
			}

			.wx-text {
				display: grid;
				gap: 2px;
				text-align: right;
			}

			.wx-text .t {
				font-weight: 700;
				font-size: 12px;
			}

			.wx-text .d {
				font-size: 12px;
				color: var(--muted);
			}

			.wx-source {
				font-size: 11px;
				color: rgba(47, 79, 79, 0.55);
			}

			.items {
				margin-top: 12px;
				display: grid;
				gap: 10px;
			}

			.card {
				background: var(--card);
				border: 1px solid var(--line);
				border-radius: var(--radius);
				box-shadow: var(--shadow);
				overflow: hidden;
			}

			.card[draggable="true"] {
				cursor: grab;
			}

			.card.dragging {
				opacity: 0.65;
			}

			.card-top {
				display: flex;
				align-items: center;
				justify-content: space-between;
				gap: 12px;
				padding: 12px;
			}

			.tag {
				display: inline-flex;
				align-items: center;
				gap: 6px;
				padding: 6px 10px;
				border-radius: 999px;
				font-size: 12px;
				font-weight: 700;
				line-height: 1;
				border: 1px solid rgba(0, 0, 0, 0.06);
			}

			.tag.sight {
				background: rgba(32, 178, 170, 0.16);
				color: #0b5c58;
			}
			.tag.food {
				background: rgba(255, 149, 0, 0.18);
				color: #8a4f00;
			}
			.tag.transit {
				background: rgba(99, 102, 241, 0.12);
				color: #3f4d7a;
			}
			.tag.stay {
				background: rgba(47, 79, 79, 0.12);
				color: var(--ink);
			}
			.tag.shop {
				background: rgba(255, 107, 107, 0.14);
				color: #7a2b2b;
			}
			.tag.other {
				background: rgba(47, 79, 79, 0.08);
				color: var(--ink);
			}

			.time {
				font-size: 12px;
				color: var(--muted);
				font-weight: 600;
			}

			.card-body {
				padding: 0 12px 12px;
				display: grid;
				gap: 8px;
			}

			.note-input {
				width: 100%;
				min-height: 92px;
				resize: vertical;
				padding: 10px 10px;
				border-radius: 12px;
				border: 1px solid rgba(47, 79, 79, 0.18);
				background: #fff;
				font-size: 13px;
				line-height: 1.45;
				color: var(--ink);
			}

			.note-input:focus {
				outline: none;
				border-color: rgba(47, 79, 79, 0.34);
			}

			.name {
				font-size: 15px;
				font-weight: 800;
				letter-spacing: 0.1px;
			}

			.row {
				display: grid;
				grid-template-columns: 72px 1fr;
				gap: 10px;
				font-size: 13px;
				line-height: 1.35;
			}

			.row .k {
				color: rgba(47, 79, 79, 0.6);
				font-weight: 700;
			}

			.row .v {
				color: var(--ink);
			}

			.guide {
				display: flex;
				flex-wrap: wrap;
				gap: 8px;
				margin-top: 2px;
			}

			.pill {
				display: inline-flex;
				align-items: center;
				padding: 6px 10px;
				border-radius: 999px;
				font-size: 12px;
				font-weight: 800;
				border: 1px solid rgba(0, 0, 0, 0.06);
			}
			.pill.must-eat {
				background: rgba(255, 59, 48, 0.14);
				color: #7a1b17;
			}
			.pill.must-order {
				background: rgba(255, 149, 0, 0.18);
				color: #8a4f00;
			}
			.pill.must-buy {
				background: rgba(175, 82, 222, 0.16);
				color: #4c1c66;
			}
			.pill.reserve {
				background: rgba(10, 132, 255, 0.16);
				color: #063a74;
			}

			details.story {
				border-top: 1px dashed rgba(47, 79, 79, 0.24);
				padding-top: 8px;
			}

			details.story > summary {
				cursor: pointer;
				user-select: none;
				font-size: 13px;
				font-weight: 800;
				color: var(--ink);
				list-style: none;
			}

			details.story > summary::-webkit-details-marker {
				display: none;
			}

			details.story > summary .hint {
				font-size: 12px;
				font-weight: 700;
				color: rgba(47, 79, 79, 0.6);
				margin-left: 8px;
			}

			details.story p {
				margin: 8px 0 0;
				font-size: 13px;
				color: rgba(47, 79, 79, 0.78);
				line-height: 1.45;
			}

			.actions {
				display: flex;
				gap: 10px;
				align-items: center;
				justify-content: flex-end;
				margin-top: 4px;
			}

			.btn {
				appearance: none;
				border: 1px solid rgba(47, 79, 79, 0.18);
				background: rgba(47, 79, 79, 0.06);
				color: var(--ink);
				border-radius: 12px;
				padding: 10px 12px;
				min-height: 44px;
				font-weight: 800;
				font-size: 13px;
				text-decoration: none;
				display: inline-flex;
				align-items: center;
				justify-content: center;
				gap: 8px;
			}

			.btn.primary {
				background: var(--accent);
				color: #fff;
				border-color: rgba(0, 0, 0, 0.06);
			}

			.btn:active {
				transform: translateY(1px);
			}

			.tool-grid {
				display: grid;
				gap: 12px;
			}

			.section-title {
				font-size: 14px;
				font-weight: 900;
				margin: 0 0 8px;
			}

			.tool-card {
				background: var(--card);
				border: 1px solid var(--line);
				border-radius: var(--radius);
				box-shadow: var(--shadow);
				padding: 12px;
			}

			.hotel-box {
				border: 1px solid var(--line);
				border-radius: 16px;
				padding: 12px;
				margin-top: 10px;
			}

			.hotel-box .hotel-name {
				font-size: 14px;
				font-weight: 950;
				margin: 0;
			}

			.hotel-box .hotel-stay {
				margin-top: 4px;
				font-size: 12px;
				color: var(--muted);
				font-weight: 800;
			}

			.hotel-fields {
				display: grid;
				grid-template-columns: 1fr 1fr;
				gap: 10px;
				margin-top: 10px;
			}

			.tool-card .small {
				font-size: 12px;
				color: var(--muted);
				margin-top: 6px;
				line-height: 1.45;
			}

			.kv {
				display: grid;
				gap: 8px;
				margin-top: 10px;
			}

			.kv .line {
				display: grid;
				grid-template-columns: 92px 1fr;
				gap: 10px;
				font-size: 13px;
				line-height: 1.35;
			}

			.kv .line .k {
				color: rgba(47, 79, 79, 0.6);
				font-weight: 800;
			}

			.kv .line .v {
				font-weight: 650;
			}

			.ledger {
				display: grid;
				gap: 12px;
				margin-top: 10px;
			}

			.ledger form {
				display: grid;
				grid-template-columns: 1fr 1fr;
				gap: 10px;
			}

			.ledger form .full {
				grid-column: 1 / -1;
			}

			label {
				display: grid;
				gap: 6px;
				font-size: 12px;
				font-weight: 800;
				color: rgba(47, 79, 79, 0.72);
			}

			input,
			select {
				width: 100%;
				min-height: 44px;
				border-radius: 12px;
				border: 1px solid rgba(47, 79, 79, 0.18);
				background: #fff;
				padding: 10px 12px;
				font-size: 14px;
				color: var(--ink);
				outline: none;
			}

			input:focus,
			select:focus {
				border-color: rgba(47, 79, 79, 0.4);
				box-shadow: 0 0 0 3px rgba(47, 79, 79, 0.12);
			}

			.table {
				width: 100%;
				border-collapse: collapse;
				overflow: hidden;
				border-radius: 12px;
				border: 1px solid var(--line);
			}

			.table th,
			.table td {
				padding: 10px 10px;
				border-bottom: 1px solid rgba(47, 79, 79, 0.12);
				font-size: 13px;
				text-align: left;
				vertical-align: top;
			}

			.table th {
				background: rgba(47, 79, 79, 0.06);
				font-weight: 900;
			}

			.table tr:last-child td {
				border-bottom: none;
			}

			.table .right {
				text-align: right;
			}

			.danger {
				background: rgba(255, 59, 48, 0.10);
				border-color: rgba(255, 59, 48, 0.18);
				color: #7a1b17;
			}

			.tabs {
				position: fixed;
				bottom: 0;
				left: 0;
				right: 0;
				z-index: 10;
				background: rgba(245, 245, 245, 0.92);
				backdrop-filter: blur(12px);
				border-top: 1px solid var(--line);
			}

			.tabs-inner {
				max-width: 560px;
				margin: 0 auto;
				padding: 10px 12px;
				display: grid;
				grid-template-columns: repeat(3, minmax(0, 1fr));
				gap: 10px;
			}

			.tab {
				min-height: 50px;
				border-radius: 14px;
				border: 1px solid rgba(47, 79, 79, 0.18);
				background: #fff;
				font-weight: 900;
				display: inline-flex;
				align-items: center;
				justify-content: center;
				gap: 10px;
			}

			.tab[aria-selected="true"] {
				background: rgba(47, 79, 79, 0.08);
				border-color: rgba(47, 79, 79, 0.30);
			}

			.hint-note {
				font-size: 12px;
				color: rgba(47, 79, 79, 0.62);
				line-height: 1.45;
				margin: 10px 2px 0;
			}

			.day-tabs {
				position: sticky;
				top: 64px;
				z-index: 4;
				margin: 0 -16px 12px;
				padding: 10px 16px;
				overflow-x: auto;
				display: flex;
				gap: 10px;
				scrollbar-width: none;
				background: rgba(245, 245, 245, 0.92);
				backdrop-filter: blur(10px);
				border-bottom: 1px solid rgba(47, 79, 79, 0.10);
			}

			.day-tabs::-webkit-scrollbar {
				display: none;
			}

			.day-tab {
				flex: 0 0 auto;
				min-height: 44px;
				padding: 10px 12px;
				border-radius: 999px;
				border: 1px solid rgba(47, 79, 79, 0.18);
				background: #fff;
				color: var(--ink);
				font-weight: 900;
				font-size: 13px;
				white-space: nowrap;
			}

			.day-tab[aria-selected="true"] {
				background: rgba(47, 79, 79, 0.10);
				border-color: rgba(47, 79, 79, 0.34);
			}

			.day-tab:active {
				transform: translateY(1px);
			}

			@media (max-width: 360px) {
				.row {
					grid-template-columns: 64px 1fr;
				}
				.kv .line {
					grid-template-columns: 86px 1fr;
				}
			}
		</style>
	</head>
	<body>
		<div class="app" id="app">
			<header class="topbar">
				<div class="topbar-inner">
					<div class="title">
						<h1>ğŸŒ¸ 2026 äº¬é˜ªç¥è¡Œç¨‹å°å·¥å…·</h1>
						<div class="wx-source" id="nowHint"></div>
					</div>
					<p class="subtitle">æ‰‹æ©Ÿå„ªå…ˆï½œä¸€é æå®šæ¯æ—¥è¡Œç¨‹ï¼‹åƒåƒå–å–ï¼‹æ—…è¡Œå·¥å…·ç®±</p>
				</div>
			</header>

			<main>
				<section class="page" id="page-daily" aria-hidden="false">
					<div class="day-tabs" id="dayTabs" role="tablist" aria-label="æ¯æ—¥åˆ†é "></div>
					<div id="dailyRoot"></div>
					<div class="hint-note">
						å¤©æ°£æ¨¡çµ„é è¨­ç‚ºã€Œç¤ºæ„è³‡æ–™ã€ã€‚è¦å•Ÿç”¨å³æ™‚å¤©æ°£ï¼šè«‹åœ¨ç¨‹å¼ç¢¼ä¸­å¡«å…¥ `WEATHERAPI_KEY`ã€‚
					</div>
				</section>

				<section class="page" id="page-food" aria-hidden="true">
					<div class="day-tabs" id="foodPlaceTabs" role="tablist" aria-label="åƒåƒå–å–åœ°é»"></div>
					<div id="foodRoot"></div>
				</section>

				<section class="page" id="page-tools" aria-hidden="true">
					<div class="tool-grid" id="toolsRoot"></div>
				</section>
			</main>

			<nav class="tabs" aria-label="ä¸»è¦å°è¦½">
				<div class="tabs-inner">
					<button class="tab" id="tab-daily" aria-selected="true" type="button">
						ğŸ—“ï¸ æ¯æ—¥è¡Œç¨‹
					</button>
					<button class="tab" id="tab-food" aria-selected="false" type="button">
						ğŸ´ åƒåƒå–å–
					</button>
					<button class="tab" id="tab-tools" aria-selected="false" type="button">
						ğŸ§° æ—…è¡Œå·¥å…·ç®±
					</button>
				</div>
			</nav>
		</div>

		<script>
			/**
			 * è³‡æ–™è¼¸å…¥ï¼ˆçµæ§‹åŒ–æ–‡å­—ï¼‰ï¼š
			 * - ä½ å¯ä»¥ç›´æ¥æŠŠæ–°çš„ CSV æ–‡å­—è²¼åˆ° `ITINERARY_CSV`ï¼Œç³»çµ±æœƒè‡ªå‹•è§£æèˆ‡æ¸²æŸ“ã€‚
			 */
			const ITINERARY_CSV = `æ—¥æœŸ,æ™‚é–“,é¡å‹,åç¨±,è©³ç´°è³‡è¨Š,åœ°å€/åœ°é»,è²»ç”¨,å‚™è¨»/æ”»ç•¥
4/16,19:20,æŠµé”,é—œè¥¿æ©Ÿå ´ (KIX),èˆªç­ D7378 è½åœ°,å¤§é˜ªåºœæ³‰ä½é‡å¸‚æ³‰å·ç©ºæ¸¯åŒ—,-,æå‰å¡«å¦¥ Visit Japan Web æƒç¢¼å…¥å¢ƒ
4/16,20:44,äº¤é€š,JR Haruka,é—œè¥¿æ©Ÿå ´ç›´é”äº¬éƒ½è»Šç«™,JR é—œè¥¿æ©Ÿå ´ç«™ 4 è™Ÿæœˆå°,"ğŸ’° 2,420å††",ã€é ç´„ã€‘Klook è³¼ç¥¨ï¼Œç¶ è‰²æ©Ÿå°å…Œæ›å¯¦é«”ç¥¨
4/16,22:30,ä½å®¿,CheckIn Hotel å››æ¢çƒä¸¸,è¾¦ç†å…¥ä½æ‰‹çºŒ,äº¬éƒ½å¸‚ä¸­äº¬åŒºæ‰‹æ´—æ°´ç”º654-2,-,21 è™Ÿå‡ºå£æ­¥è¡Œ 2 åˆ†é˜ï¼Œ1F æœ‰ Lawson
4/17,07:30,æ™¯é»,ä¼è¦‹ç¨»è·å¤§ç¤¾,é¿é–‹äººæ½®ï¼Œç¨äº«åƒæœ¬é³¥å±…,äº¬éƒ½å¸‚ä¼è¦‹åŒºæ·±è‰è—ªä¹‹å†…ç”º68,ğŸ†“ å…è²»,ã€å¿…çœ‹ã€‘ç‹ç‹¸ç¹ªé¦¬ï¼Œå»ºè­°æ¸…æ™¨æŠµé”å¯æ‹ç©ºæ™¯
4/17,10:00,æ™¯é»,æ¸…æ°´å¯º,å·¡éŠæ¸…æ°´èˆå°èˆ‡åœ°ä¸»ç¥ç¤¾,äº¬éƒ½å¸‚æ±å±±åŒºæ¸…æ°´1-294,ğŸ’° 500å††,ã€å¿…çœ‹ã€‘æœ¬å ‚èˆå°ã€éŸ³ç¾½ä¹‹ç€§ç¥ˆç¦
4/17,12:00,è³¼ç‰©,äºŒå¹´å‚/ä¸‰å¹´å‚,å……æ»¿å¤éƒ½é¢¨å‘³çš„æ•£ç­–å°è·¯,äº¬éƒ½å¸‚æ±å±±åŒºæ¸…æ°´,-,ã€å¿…çœ‹ã€‘å®®å´é§¿å•†åº—ã€ç‰¹è‰²æ˜Ÿå·´å…‹
4/17,14:00,è³¼ç‰©,éŒ¦å¸‚å ´,äº¬éƒ½äººçš„å»šæˆ¿ï¼Œå„é¡æµ·é®®å°åƒ,äº¬éƒ½å¸‚ä¸­äº¬åŒºè¥¿å¤§æ–‡å­—ç”º609,"ğŸ’° 2,000å††",ã€å¿…åƒã€‘è±†ä¹³ç”œç”œåœˆï¼Œ18:00 å‰æœƒæ”¶æ”¤
4/17,16:30,æ™¯é»,ä¸‹é´¨ç¥ç¤¾,ä¸–ç•Œéºç”¢ï¼Œå®ˆè­·å¥³æ€§çš„ç¥ç¤¾,äº¬éƒ½å¸‚å·¦äº¬åŒºä¸‹é´¨æ³‰å·ç”º59,ğŸ†“ å…è²»,ã€å¿…è²·ã€‘è¶…å”¯ç¾ã€Œè•¾çµ²å¾¡å®ˆã€èˆ‡ã€Œæ°´å®ˆã€
4/17,19:30,é¤å»³,æ»¿å¤©ä¸²ç‡’ (å…ˆæ–—ç”º),é´¨å·æ—æ¥µå…·æ°£æ°›çš„ä¸²ç‡’åº—,äº¬éƒ½å¸‚ä¸­äº¬åŒºè‹¥æ¾ç”º140-1,"ğŸ’° 4,000å††",ã€å¿…é»ã€‘é›è‚‰ä¸¸ä¸²ã€é›çš®ä¸²ï¼Œå»ºè­°é ç´„
4/18,08:00,äº¤é€š,JR å±±é™°æœ¬ç·š,æ­å¾€é¦¬å €ç«™è½‰å°ç«è»Š,JR äº¬éƒ½è»Šç«™æˆ–äºŒæ¢ç«™,ğŸ’° 330å††,å¾é£¯åº—å‡ºç™¼å»ºè­°æ­æ±è¥¿ç·šè‡³äºŒæ¢ç«™è½‰ JR
4/18,09:02,æ™¯é»,åµå±±å°ç«è»Š,é¾œå²¡ç«™ç™¼è»Šå‰å¾€åµå±±ç«™,é¾œå²¡è§€å…‰è»Šç«™,ğŸ’° 880å††,ã€é ç´„ã€‘å®˜ç¶²æå‰è¨‚ç¥¨ï¼Œæ¨è–¦é›™æ•¸åº§
4/18,10:30,æ™¯é»,å¾¡é«®ç¥ç¤¾,å…¨æ—¥å”¯ä¸€é ­é«®å®ˆè­·ç¥,äº¬éƒ½å¸‚å³äº¬åŒºåµ¯å³¨å°å€‰å±±ç”°æ·µå±±ç”º10,ğŸ†“ å…è²»,ã€å¿…çœ‹ã€‘å‰ªä¸‹ä¸€æ’®é ­é«®æ”¾å…¥ã€Œé«®å¡šã€ç¥ˆç¦
4/18,11:30,æ™¯é»,ç«¹æ—å°å¾‘,è½é¢¨å¹éç«¹æ—çš„éœè¬æ„Ÿ,äº¬éƒ½å¸‚å³äº¬åŒºåµ¯å³¨å°å€‰å±±,ğŸ†“ å…è²»,ã€å¿…çœ‹ã€‘åµå±±ä»£è¡¨æ€§æ™¯è§€ï¼Œé›»å½±å–æ™¯åœ°
4/18,13:00,é¤å»³,åµå±±å•†æ¥­è¡—,åœ¨åœ°å°åƒèˆ‡ Miffy éºµåŒ…,äº¬éƒ½å¸‚å³äº¬åŒºåµ¯å³¨å¤©é¾å¯ºé€ è·¯ç”º,"ğŸ’° 2,000å††",ã€å¿…è²·ã€‘Miffy åµå±±é™å®šæ¬¾ç´…è±†éºµåŒ…
4/19,08:30,æ™¯é»,å®‡æ²»å¹³ç­‰é™¢,ç¡¬å¹£ä¸Šçš„åƒå¹´é³³å‡°å ‚,å®‡æ²»å¸‚å®‡æ²»è“®è¯116,ğŸ’° 700å††,ã€å¿…çœ‹ã€‘é³³å‡°å ‚åæ˜ åœ¨æ± æ°´ä¸Šçš„å€’å½±
4/19,11:30,é¤å»³,ä¸­æ‘è—¤å‰ æœ¬åº—,å®‡æ²»æŠ¹èŒ¶ç”œé»å¤©èŠ±æ¿,å®‡æ²»å¸‚å®‡æ²»å£±ç•ª10,"ğŸ’° 3,000å††",ã€å¿…é»ã€‘ç«¹ç­’æŠ¹èŒ¶å†°æ·‡æ·‹ï¼Œéœ€ç¾å ´æŠ½è™Ÿç¢¼ç‰Œ
4/19,14:30,æ™¯é»,å¥ˆè‰¯å…¬åœ’,èˆ‡è¦ªäºº(è²ªåƒ)çš„é¹¿äº’å‹•,å¥ˆè‰¯å¸‚é›‘å¸ç”º,ğŸ’° 200å††,ã€å¿…åƒã€‘é¹¿ä»™è²ï¼Œå°å¿ƒåˆ¥è¢«é¹¿ç¾¤åŒ…åœ
4/19,16:30,æ™¯é»,è‹¥è‰å±±,ç™»ä¸Šå±±å¡çœºæœ›å¥ˆè‰¯å…¨æ™¯,å¥ˆè‰¯å¸‚é›‘å¸ç”º,ğŸ’° 150å††,ã€å¿…çœ‹ã€‘å¤•é™½æ¥µç¾ï¼Œéœ€åœ¨ 17:00 å‰å…¥å ´
4/19,20:00,ä½å®¿,ZONE å¿ƒé½‹æ©‹è¥¿å€,æŠµé”å¤§é˜ªé£¯åº— Check-in,å¤§é˜ªå¸‚è¥¿åŒºç«‹å£²å €1-10-2,-,æœ¬ç”ºç«™/å¿ƒé½‹æ©‹ç«™æ­¥è¡Œå¯é”
4/20,08:30,äº¤é€š,å¾¡å ‚ç­‹ç·š+å…¬è»Š,å‰å¾€å‹å°¾å¯ºæœ€å¿«è·¯å¾‘,ç®•é¢è±é‡ç«™ 8 è™Ÿç«™å°,ğŸ’° 660å††,2026 æ–°åœ°æ¨™ç®•é¢è±é‡ç«™è½‰ 30 è™Ÿå·´å£«
4/20,10:45,æ™¯é»,å‹å°¾å¯º,æ»¿å‘æ»¿è°·çš„ç¥ˆç¦ä¸å€’ç¿,ç®•é¢å¸‚ç²Ÿç”Ÿé–“è°·2914-1,ğŸ’° 500å††,ã€å¿…åƒã€‘é”æ‘©é€ å‹ä¾¿ç•¶ï¼Œã€å¿…è²·ã€‘ä¸å€’ç¿å¾¡å®ˆ
4/20,14:00,æ™¯é»,ç®•é¢å¤§ç€‘å¸ƒ,è² é›¢å­æ»¿æ»¿çš„æ£®æ—æ•£æ­¥,ç®•é¢å¸‚ç®•é¢å…¬åœ’,ğŸ†“ å…è²»,ã€å¿…åƒã€‘ç‚¸æ¥“è‘‰ï¼Œå£æ„Ÿé…¥è„†å¾®ç”œ
4/20,18:00,è³¼ç‰©,å¿ƒé½‹æ©‹/é“é “å €,å¤§é˜ªåœ°æ¨™èˆ‡è—¥å¦æ¡è²·,å¤§é˜ªå¸‚ä¸­å¤®åŒºå¿ƒé½‹æ©‹ç­‹,-,ã€å¿…çœ‹ã€‘è·‘è·‘äººå›ºåŠ›æœéœ“è™¹ç‡ˆ
4/21,09:00,æ™¯é»,å¤§é˜ªåŸå¤©å®ˆé–£,å¤§é˜ªè±¡å¾µï¼Œå®å‰å£¯è§€,å¤§é˜ªå¸‚ä¸­å¤®åŒºå¤§é˜ªåŸ1-1,ğŸ’° 600å††,ã€å¿…çœ‹ã€‘ç™»ä¸Šé ‚æ¨“ä¿¯ç°å¤§é˜ªå¸‚å€æ™¯è§€
4/21,12:00,é¤å»³,é»‘é–€å¸‚å ´,é«˜å“è³ªæµ·é®®ã€ç¥æˆ¶ç‰›,å¤§é˜ªå¸‚ä¸­å¤®åŒºæ—¥æœ¬æ©‹2-4-1,"ğŸ’° 4,000å††",ã€å¿…åƒã€‘ç¾é–‹ç”Ÿè ”ã€ä¸¸å–„é£Ÿè‚‰åº—ç¥æˆ¶ç‰›
4/21,15:00,æ™¯é»,é›£æ³¢å…«é˜ªç¥ç¤¾,å¨é¢¨å‡œå‡œçš„å·¨å¤§ç…å­æ®¿,å¤§é˜ªå¸‚æµªé€ŸåŒºå…ƒç”º2-9-19,ğŸ†“ å…è²»,ã€å¿…çœ‹ã€‘ç…å­é ­å¤§æ®¿ï¼Œè±¡å¾µå¸èµ°å„é‹
4/21,18:00,æ™¯é»,æ¢…ç”°ç©ºä¸­åº­åœ’,æœªä¾†æ„Ÿå»ºç¯‰èˆ‡é«˜ç©ºå¤œæ™¯,å¤§é˜ªå¸‚åŒ—åŒºå¤§æ·€ä¸­1-1-88,"ğŸ’° 1,500å††",ã€å¿…çœ‹ã€‘éœ²å¤©åœ“å½¢å±•æœ›å°ï¼Œæƒ…ä¾¶ç´„æœƒè–åœ°
4/22,10:00,è³¼ç‰©,é›£æ³¢ Parco/å¤§ä¸¸,æœ€å¾Œè¡Œæå¡æ»¿æ©Ÿæœƒ,å¤§é˜ªå¸‚ä¸­å¤®åŒºå¿ƒé½‹æ©‹ç­‹1-7-1,-,ã€å¿…åƒã€‘Shake Shack æ¼¢å ¡
4/22,15:00,è³¼ç‰©,è‡¨ç©ºåŸ Outlet,æ©Ÿå ´å‰æœ€å¾Œä¸€ç«™å¤§æƒè²¨,æ³‰ä½é‡å¸‚ã‚Šã‚“ãã†å¾€ä¾†å—3-28,-,ã€å¿…è²·ã€‘é‹å‹•å“ç‰Œã€ç²¾å“æŠ˜æ‰£æ¥µå¤§
4/22,18:30,äº¤é€š,å—æµ·é›»éµ,è‡¨ç©ºåŸè‡³é—œè¥¿æ©Ÿå ´,å—æµ·é›»éµè‡¨ç©ºåŸç«™,ğŸ’° 370å††,åƒ…éœ€ 6 åˆ†é˜å³å¯æŠµé” T1 èˆªå»ˆ
4/22,20:55,èµ·é£›,é—œè¥¿æ©Ÿå ´ (KIX),èˆªç­ D7379 èµ·é£›å›å°,å¤§é˜ªåºœæ³‰ä½é‡å¸‚æ³‰å·ç©ºæ¸¯åŒ—,-,å»ºè­°æå‰ 3 å°æ™‚æŠµé”è¾¦ç†ç™»æ©Ÿ`;

			const FOOD_CSV = `æ¨™é¡Œ,ç­†è¨˜,ç¶²å€,æ¨™ç±¤,ç•™è¨€
,,,ğŸ¨ å®¶;ğŸ¤˜ åƒé£¯é£¯;ğŸƒ æ™¯é»,
Kiyasu Sohonpo,,https://www.google.com/maps/place/Kiyasu+Sohonpo/data=!4m2!3m1!1s0x6000e5ce1ef2f257:0x75f0a2e2b26b1e7e,ğŸ¤˜ åƒé£¯é£¯,
åŸé‡€æ‹‰éºµ ä¹…ä¿ç”°,"â—ï¸è²¼å¿ƒæé†’ï¼šé€™å®¶åº—éœ€è¦å…ˆé€²é–€åœ¨è²©è³£æ©Ÿé»é¤å¥½å†åˆ°å¤–é¢æ’éšŠï¼Œç­‰åº—å“¡å‡ºä¾†æ”¶ä½ é»é¤çš„å–®å­ï¼Œåƒè¬ä¸è¦è·Ÿè‘—äººæ½®å‚»å‚»åœ°æ’éšŠ

ä¾†æ—¥æœ¬æ€éº¼å¯ä»¥éŒ¯éåœ¨åœ°æ‹‰éºµåº—ï¼Œé€™å®¶ä½æ–¼äº¬éƒ½è»Šç«™é™„è¿‘ï¼Œåœ¨Googleè©•è«–ä¸Šç®—æ˜¯éå¸¸é«˜çš„æ‹‰éºµåº—ğŸœ(2600å¤šå‰‡è©•è«–é‚„æœ‰4.4é¡†æ˜Ÿï¼Œåœ¨æ—¥æœ¬ç®—æ˜¯å¯¶è—ååº—äº†)ï¼Œæˆ‘çœ‹éä¸å°‘ç¶²ç´…æ‹ç‰‡ä»‹ç´¹éï¼Œä¹Ÿè¨±æœ‰ä¸å°‘äººå·²ç¶“çŸ¥é“é€™é–“åº—ï¼Œä½†æˆ‘é‚„æ˜¯å¾ˆæƒ³ä»‹ç´¹çµ¦å¤§å®¶ã€‚é‚„è¨˜å¾—æ¯æ¬¡ç¶“éé€™æ¢è·¯éƒ½æœƒçœ‹åˆ°å¤§æ’é•·é¾çš„äººæ½®ï¼Œç¬¬ä¸€æ¬¡åƒçš„æ™‚å€™æ˜¯æ™šä¸Š8é»å¤šé‚„æ’äº†1å€‹å¤šå°æ™‚ï¼Œä½†æˆ‘å¿…é ˆèªªçœŸçš„å€¼å¾—ğŸ¥¹ éå¸¸æ¨è–¦é€™é–“çš„æ²¾éºµï¼Œæ¹¯é ­æ˜¯æˆ‘åœ¨å…¶ä»–åœ°æ–¹æ²’æœ‰å–éçš„ï¼Œçµ•å°ä¸æ˜¯ä»€éº¼å‘³å™Œã€é†¬æ²¹ã€é¹½å‘³çš„å£å‘³ï¼Œæˆ‘è¦ºå¾—å¤šäº†äº›æµ·é®®çš„é®®å‘³å¤–ï¼Œé‚„å¸¶é»å¾®å¾®çš„è¾£ä½†ä¸æœƒåƒæ—¥æœ¬æ‹‰éºµçµ¦äººæ—¢å®šå°è±¡æ˜¯åé¹¹è¦çŒ›çŒæ°´ï¼Œæ˜¯é‚£ç¨®æœƒè®“äººå¿ä¸ä½ä¸€å£æ¥è‘—ä¸€å£çš„æ¹¯é ­ğŸ¤¤ å¦‚æœæ˜¯é£Ÿé‡æ¯”è¼ƒå¤§çš„äººå¯ä»¥é»éºµåŠ å¤§æˆ–æ˜¯å¦å¤–åŠ é»ä¸€ç¢—å±±æ¤’é£¯ï¼Œæ—¥å¹£1000å¤šå°±å¯ä»¥åƒå¾ˆé£½ï¼Œä¹Ÿæ˜¯ä¸€å®¶é«˜CPå€¼çš„åº—ï¼Œæ¨è–¦çµ¦å¤§å®¶ğŸ™ŒğŸ»

âš ï¸å°Tipsï¼šåº—å…§å¤§æ¦‚åªæœ‰10å€‹ä½å­ï¼Œåªæœ‰åœ¨å®ƒç‡Ÿæ¥­å‰å»æ’éšŠé€™å€‹é¸é …ï¼Œä¸ç„¶åŸºæœ¬ä¸Šéƒ½æ˜¯éœ€è¦æ’éšŠçš„ï¼Œé™¤éä½ å€‹äººæœ‰ä¸ç”¨æ’éšŠçš„é«”è³ªï¼Œä¸ç„¶é‚„æ˜¯ä¹–ä¹–æ—©é»å»å¡ä½å§",https://www.google.com/maps/place/%E5%90%9F%E9%87%80%E6%8B%89%E9%BA%B5+%E4%B9%85%E4%BF%9D%E7%94%B0/data=!4m2!3m1!1s0x600108a13c7a2d5d:0x2c1acd85fdf5ca75,ğŸ¤˜ åƒé£¯é£¯,
Kyoto Ramen Koji,å„ç¨®æ‹‰éºµéƒ½åœ¨é€™è£¡,https://www.google.com/maps/place/Kyoto+Ramen+Koji/data=!4m2!3m1!1s0x6001089a3a451a29:0x8aa203d50015c17c,ğŸ¤˜ åƒé£¯é£¯,
Yukou,ç‰¡è £ï¼Œè›¤èœŠç‚ºåŸºåº•,https://www.google.com/maps/place/Yukou/data=!4m2!3m1!1s0x6001094a10b57a45:0xf30619cc172bde60,ğŸ¤˜ åƒé£¯é£¯,
Hanayori Kiyoe,æ¹¯è‘‰è±†çš®å¥¶æ²¹å¯æ¨‚é¤…,https://www.google.com/maps/place/Hanayori+Kiyoe/data=!4m2!3m1!1s0x600108941ddad50b:0x23e36cf9285ce04e,ğŸ¤˜ åƒé£¯é£¯,
Arashiyama Curry,,https://www.google.com/maps/place/Arashiyama+Curry/data=!4m2!3m1!1s0x6001a9fc2a5eddab:0x1faaab96b6721a74,ğŸ¤˜ åƒé£¯é£¯,
çƒ¤ç³°å­ åæ–‡å ‚,,https://www.google.com/maps/place/%E7%83%A4%E7%B3%B0%E5%AD%90+%E5%8D%81%E6%96%87%E5%A0%82/data=!4m2!3m1!1s0x600108c5960e571d:0x5a1738a823cf587,ğŸ¤˜ åƒé£¯é£¯,
Checkin é£¯åº— å››æ¢çƒä¸¸,,https://www.google.com/maps/place/Checkin+%E9%A3%AF%E5%BA%97+%E5%9B%9B%E6%A2%9D%E7%83%8F%E4%B8%B8/data=!4m2!3m1!1s0x6001089af1a3c3af:0xb203717b2742c744,ğŸ¨ å®¶,
Kushikatsu Daruma - Shinsekai Main Shop,ä¹åå¤šå¹´æ­·å²ç‚¸ä¸²,https://www.google.com/maps/place/Kushikatsu+Daruma+-+Shinsekai+Main+Shop/data=!4m2!3m1!1s0x6000e76009075ee5:0xeed4bda269c8a677,ğŸ¤˜ åƒé£¯é£¯,
Tokura Kyoto Sanjo,å ±è³‡æ¼¢å¯¶ç‰Œ,https://www.google.com/maps/place/Tokura+Kyoto+Sanjo/data=!4m2!3m1!1s0x6001093841eddb13:0xe457df37e90ab058,ğŸ¤˜ åƒé£¯é£¯,
â€œEkimaeâ€ kaisendon restaurant,Cpå€¼å¾ˆé«˜çš„æµ·é®®æ‡‚é£¯,https://www.google.com/maps/place/%E2%80%9CEkimae%E2%80%9D+kaisendon+restaurant/data=!4m2!3m1!1s0x6000e692c74250ad:0x7ea913318f048dee,ğŸ¤˜ åƒé£¯é£¯,
ä¸²ç‚¸ å…«é‡å‹,,https://www.google.com/maps/place/%E4%B8%B2%E7%82%B8+%E5%85%AB%E9%87%8D%E5%8B%9D/data=!4m2!3m1!1s0x6000dd8ab619eebd:0x487dcc07ecb7e704,ğŸ¤˜ åƒé£¯é£¯,
Maita-ya,"å¤§é˜ªå¸‚å€æŸå€‹å•†åº—è¡—çš„ç« é­šç‡’,

ä¸€é¡†3å††è€Œå·²,è£¡é¢éƒ½æ˜¯æ—¥æœ¬äººæ²’æœ‰è§€å…‰å®¢,é“ é “å €ä¸€ä»½éƒ½è¦800~1000å††ã€‚ 
é‚„æœ‰24å°æ™‚ç„¡äººçš„æœé£¾åº—,1000å††-5000å††,å¤§è¡£ è·Ÿçš®è¡£éƒ½åªè¦3000å††,å¤ªé¦™äº†ã€‚",https://www.google.com/maps/place/Maita-ya/data=!4m2!3m1!1s0x6000e1cb1e5ed825:0xb4d889f9021e6b64,ğŸ¤˜ åƒé£¯é£¯,
ä¸²ç‚¸ å¤©ç‹—,äººå¾ˆå¤š,https://www.google.com/maps/place/%E4%B8%B2%E7%82%B8+%E5%A4%A9%E7%8B%97/data=!4m2!3m1!1s0x6000dd8ab67eb929:0x48262d76de82d3c3,ğŸ¤˜ åƒé£¯é£¯,
æ–°ä¸–ç•Œ ã‹ã‚“ã‹ã‚“,å¤§é˜ªå‘³çš„ç« é­šç‡’ ä¸­é–“ç³Šç³Šçš„,https://www.google.com/maps/place/%E6%96%B0%E4%B8%96%E7%95%8C+%E3%81%8B%E3%82%93%E3%81%8B%E3%82%93/data=!4m2!3m1!1s0x6000e7600482136d:0x547be728d93fd887,ğŸ¤˜ åƒé£¯é£¯,
åä»£è±¬æ’,å¤§æ¨#å¤§æµ·è€ã‚«ãƒ„ã¨ãƒ’ãƒ¬ã‹ã¤(ç‚¸è¦&ç‚¸é‡Œè„Šå¥—é¤)ã€#æ¿ƒå£è±¬æ’é†¬+æ—¥å¼æŸšå­é†¬,https://www.google.com/maps/place/%E5%90%8D%E4%BB%A3%E8%B1%AC%E6%8E%92/data=!4m2!3m1!1s0x600108924b00337d:0x1628dc527e3d4e0c,ğŸ¤˜ åƒé£¯é£¯,
Kiyasu Sohonpo,,https://www.google.com/maps/place/Kiyasu+Sohonpo/data=!4m2!3m1!1s0x6000e68d76465acb:0x432401df57759f8a,ğŸ¤˜ åƒé£¯é£¯,
Taishu Sukiyaki Hokuto GEMS Namba Branch,ä¸­åˆå’Œç‰›1180,https://www.google.com/maps/place/Taishu+Sukiyaki+Hokuto+GEMS+Namba+Branch/data=!4m2!3m1!1s0x6000e78e88cf6963:0x13fe79ad645b20be,ğŸ¤˜ åƒé£¯é£¯,
Takoyakiza,,https://www.google.com/maps/place/Takoyakiza/data=!4m2!3m1!1s0x6000e70c0c0c3a51:0xf691e66fccd99861,ğŸ¤˜ åƒé£¯é£¯,
Achichi Honpo Dotonbori,,https://www.google.com/maps/place/Achichi+Honpo+Dotonbori/data=!4m2!3m1!1s0x6000e714f6c458d5:0x3e62c4440ae805e9,ğŸ¤˜ åƒé£¯é£¯,
é›£æ³¢å…«é˜ªç¥ç¤¾,,https://www.google.com/maps/place/%E9%9B%A3%E6%B3%A2%E5%85%AB%E9%98%AA%E7%A5%9E%E7%A4%BE/data=!4m2!3m1!1s0x6000e77279bd5541:0x80c374197554ea9f,ğŸƒ æ™¯é»,
BATTEN YOKATO AMERIKAMURA,æ“šèªªéš¨ä¾¿é»éƒ½ä¸é›·,https://www.google.com/maps/place/BATTEN+YOKATO+AMERIKAMURA/data=!4m2!3m1!1s0x6000e778508f87c3:0x12ff5ad43c5dbefd,ğŸ¤˜ åƒé£¯é£¯,
Takoyaki Wanaka Sennichimae,,https://www.google.com/maps/place/Takoyaki+Wanaka+Sennichimae/data=!4m2!3m1!1s0x6000e76b07f5de63:0xc68f6cb004cb8af6,ğŸ¤˜ åƒé£¯é£¯,
Sushi Ayase,åˆé¤5500,https://www.google.com/maps/place/Sushi+Ayase/data=!4m2!3m1!1s0x6000e729f4eb569d:0x42f59d7b5a8f6734,ğŸ¤˜ åƒé£¯é£¯,
æ˜¥æ—¥å¤§ç¤¾,,https://www.google.com/maps/place/%E6%98%A5%E6%97%A5%E5%A4%A7%E7%A4%BE/data=!4m2!3m1!1s0x600139c06bb06ad5:0x4c97e78382e39596,ğŸƒ æ™¯é»,
TÅdai-ji,,https://www.google.com/maps/place/T%C5%8Ddai-ji/data=!4m2!3m1!1s0x600139907a0876dd:0xf890ac3f9dd53c8f,ğŸƒ æ™¯é»,
å¥ˆè‰¯å…¬åœ’,,https://www.google.com/maps/place/%E5%A5%88%E8%89%AF%E5%85%AC%E5%9C%92/data=!4m2!3m1!1s0x60013996bd8c6061:0xf96cacf357447456,ğŸƒ æ™¯é»,
å®‡æ²»æ©‹,,https://www.google.com/maps/place/%E5%AE%87%E6%B2%BB%E6%A9%8B/data=!4m2!3m1!1s0x6001110a5313ae9d:0x36bff55a841d0d8c,ğŸƒ æ™¯é»,
å®‡æ²»ä¸Šç¥ç¤¾,,https://www.google.com/maps/place/%E5%AE%87%E6%B2%BB%E4%B8%8A%E7%A5%9E%E7%A4%BE/data=!4m2!3m1!1s0x60011173757af961:0x11600ef0d3975f5f,ğŸƒ æ™¯é»,
å®‡æ²»ç¥ç¤¾ (å…”å­ç¥ç¤¾ï¼‰,,https://www.google.com/maps/place/%E5%AE%87%E6%B2%BB%E7%A5%9E%E7%A4%BE+(%E5%85%94%E5%AD%90%E7%A5%9E%E7%A4%BE%EF%BC%89/data=!4m2!3m1!1s0x600111731014cfd9:0xe47629bd29c85f14,ğŸƒ æ™¯é»,
å»ºä»å¯º,,https://www.google.com/maps/place/%E5%BB%BA%E4%BB%81%E5%AF%BA/data=!4m2!3m1!1s0x600108c1242b7b27:0x7e608f1986c5bb52,ğŸƒ æ™¯é»,
Kamo River,,https://www.google.com/maps/place/Kamo+River/data=!4m2!3m1!1s0x600108e457079b29:0x578668ecc6840c03,ğŸƒ æ™¯é»,
Nonkiya,ç‡‰ç‰›ç­‹ï¼Œé—œæ±ç…®,https://www.google.com/maps/place/Nonkiya/data=!4m2!3m1!1s0x6000dd8aad775aa9:0x9389f475ae07f98c,ğŸ¤˜ åƒé£¯é£¯,
Osaka Dojimahama Tower,å…è²»çœ‹å¤œæ™¯çš„åœ°æ–¹,https://www.google.com/maps/place/Osaka+Dojimahama+Tower/data=!4m2!3m1!1s0x6000e7002cc79d83:0x92846010eb670590,ğŸƒ æ™¯é»,
æ¸…æ°´å¯º,,https://www.google.com/maps/place/%E6%B8%85%E6%B0%B4%E5%AF%BA/data=!4m2!3m1!1s0x600108d385dcfb07:0x62af658650c434ba,ğŸƒ æ™¯é»,
éŒ¦å¸‚å ´,,https://www.google.com/maps/place/%E9%8C%A6%E5%B8%82%E5%A0%B4/data=!4m2!3m1!1s0x6001089ccd8ccb4f:0xb69ea31001ec6c9c,ğŸƒ æ™¯é»,
ä¼è¦‹ç¨»è·å¤§ç¤¾,,https://www.google.com/maps/place/%E4%BC%8F%E8%A6%8B%E7%A8%BB%E8%8D%B7%E5%A4%A7%E7%A4%BE/data=!4m2!3m1!1s0x60010f153d2e6d21:0x7b1aca1c753ae2e9,ğŸƒ æ™¯é»,
Sukiyaki Kimura,å¾ˆé“åœ°çš„DIYå£½å–œç‡’,https://www.google.com/maps/place/Sukiyaki+Kimura/data=!4m2!3m1!1s0x60010894254122a3:0x84023cafa4c8c209,,
`;

			// === Weather ===
			// å¡«ä¸Šä½ çš„ WeatherAPI key å¯å•Ÿç”¨å³æ™‚å¤©æ°£ã€‚
			const WEATHERAPI_KEY = ""; // TODO: "YOUR_KEY"
			const WEATHER_PROVIDER = WEATHERAPI_KEY ? "weatherapi" : "mock";

			const DAY_PRIMARY_CITY = {
				"4/16": "äº¬éƒ½",
				"4/17": "äº¬éƒ½",
				"4/18": "äº¬éƒ½",
				"4/19": "äº¬éƒ½",
				"4/20": "å¤§é˜ª",
				"4/21": "å¤§é˜ª",
				"4/22": "å¤§é˜ª",
			};

			const MOCK_WEATHER = {
				äº¬éƒ½: {
					icon: "â›…ï¸",
					hi: 22,
					lo: 13,
					rain: 25,
					text: "å¤šé›²æ™‚æ™´",
				},
				å¤§é˜ª: {
					icon: "ğŸŒ¤ï¸",
					hi: 24,
					lo: 14,
					rain: 20,
					text: "æ™´åˆ°å¤šé›²",
				},
			};

			async function getWeatherForCity(city) {
				if (WEATHER_PROVIDER === "mock") {
					return { ...MOCK_WEATHER[city], source: "WeatherAPIï¼ˆç¤ºæ„ï¼‰" };
				}

				// WeatherAPI: current + forecast (ç°¡åŒ–ï¼šç”¨ç•¶å¤©é å ±)
				// Docs: https://www.weatherapi.com/
				const endpoint = new URL("https://api.weatherapi.com/v1/forecast.json");
				endpoint.searchParams.set("key", WEATHERAPI_KEY);
				endpoint.searchParams.set("q", city);
				endpoint.searchParams.set("days", "1");
				endpoint.searchParams.set("lang", "zh");

				const res = await fetch(endpoint);
				if (!res.ok) throw new Error("WeatherAPI request failed");
				const data = await res.json();
				const day = data?.forecast?.forecastday?.[0]?.day;
				return {
					icon: "ğŸŒ¦ï¸",
					hi: Math.round(day?.maxtemp_c ?? 0),
					lo: Math.round(day?.mintemp_c ?? 0),
					rain: Math.round(day?.daily_chance_of_rain ?? 0),
					text: day?.condition?.text ?? "-",
					source: "WeatherAPI",
				};
			}

			// === Stories / Tips (50-100å­—å·¦å³) ===
			const STORY = {
				"ä¼è¦‹ç¨»è·å¤§ç¤¾":
					"ä»¥åƒæœ¬é³¥å±…èåçš„ç¨»è·ä¿¡ä»°ç¸½æœ¬ç¤¾ã€‚æ¸…æ™¨äººå°‘ã€å…‰ç·šæŸ”å’Œï¼Œæ‹ç…§æ›´ä¹¾æ·¨ï¼›è‹¥é«”åŠ›å…è¨±å¯å¾€ä¸Šèµ°ä¸€æ®µï¼Œè¶Šå¾€ä¸Šè¶Šå®‰éœã€‚",
				æ¸…æ°´å¯º:
					"æ¸…æ°´èˆå°æ¡æ‡¸ç©ºæœ¨æ§‹å·¥æ³•ï¼Œæ˜¯äº¬éƒ½ä»£è¡¨æ€§æ™¯è§€ã€‚éŸ³ç¾½ä¹‹ç€§ä¸‰é“æ³‰æ°´å¯“æ„ä¸åŒï¼Œç¿’ä¿—æ˜¯æ“‡ä¸€å–ç”¨æ›´éˆé©—ï¼›å¡é“å€åŸŸçŸ³éšå¤šï¼Œå»ºè­°ç©¿å¥½èµ°çš„é‹ã€‚",
				"å®‡æ²»å¹³ç­‰é™¢":
					"é³³å‡°å ‚æ˜¯ 10 åœ“ç¡¬å¹£ä¸Šçš„ç¶“å…¸åœ–æ¡ˆï¼Œæ± æ°´å€’å½±å¾ˆåƒå…‰ç·šèˆ‡é¢¨ï¼›å»ºè­°é–‹é–€æ™‚æ®µå…ˆå…¥åœ’ï¼Œé¿é–‹åœ˜å®¢å°–å³°ï¼Œé€›èµ·ä¾†æ›´èˆ’æœã€‚",
				"å¥ˆè‰¯å…¬åœ’":
					"é¹¿å¾ˆè¦ªäººä¹Ÿå¾ˆæœƒæ¶é£Ÿã€‚æ‹¿é¹¿ä»™è²æ™‚æŠŠåŒ…è£æ”¶å¥½ã€æ‰‹ä¼¸ç›´çµ¦é¤…ï¼Œåˆ¥ä¸€æ¬¡æå‡ºä¸€å¤§æŠŠï¼›è¢«åœä½å°±å¿«æ­¥é›¢é–‹äººç¾¤è¼ƒå°‘çš„å€åŸŸã€‚",
				å‹å°¾å¯º:
					"ä»¥ã€Œå‹é‹ã€é”æ‘©èåï¼Œè§’è½èˆ‡éšæ¢¯æ—å¸¸æœ‰é©šå–œé”æ‘©ç‰†ã€‚è‹¥æƒ³æ‹åˆ°äººå°‘çš„ç•«é¢ï¼Œè¶Šæ—©æŠµé”è¶Šå¥½ï¼›å±±ä¸Šæ°£æº«åä½ï¼Œå¸¶ä»¶è–„å¤–å¥—æ›´èˆ’é©ã€‚",
				"å¤§é˜ªåŸå¤©å®ˆé–£":
					"å¤©å®ˆé–£æ˜¯å¤§é˜ªè±¡å¾µï¼Œå…§éƒ¨å¤šç‚ºå±•è¦½å‹•ç·šï¼Œç™»é«˜å¯ä¿¯ç°è­·åŸæ²³èˆ‡åŸå¸‚å¤©éš›ç·šã€‚æ—©ä¸Šé–‹é–€å…ˆä¸Šæ¨“ï¼Œé€šå¸¸æ’éšŠæ›´çŸ­ã€è¦–é‡ä¹Ÿæ›´æ¸…æ™°ã€‚",
				"æ¢…ç”°ç©ºä¸­åº­åœ’":
					"éœ²å¤©åœ“å½¢å±•æœ›å°æ˜¯æ‹›ç‰Œï¼Œé«˜ç©ºé¢¨å¤§åæ¶¼ï¼›æ—¥è½å‰å¾Œæ˜¯æœ€ä½³æ™‚æ®µï¼Œèƒ½åŒæ™‚æ”¶ä¸‹é»ƒæ˜èˆ‡å¤œæ™¯ï¼Œå»ºè­°æå‰åˆ°ç¾å ´é¿é–‹å°–å³°æ’éšŠã€‚",
			};

			// === CSV parser (supports quoted fields) ===
			function parseCSV(csv) {
				const rows = [];
				let current = [];
				let value = "";
				let inQuotes = false;

				for (let i = 0; i < csv.length; i++) {
					const ch = csv[i];
					const next = csv[i + 1];

					if (ch === '"') {
						if (inQuotes && next === '"') {
							value += '"';
							i++;
							continue;
						}
						inQuotes = !inQuotes;
						continue;
					}

					if (!inQuotes && ch === ",") {
						current.push(value);
						value = "";
						continue;
					}

					if (!inQuotes && (ch === "\n" || ch === "\r")) {
						if (ch === "\r" && next === "\n") i++;
						current.push(value);
						value = "";
						if (current.some((cell) => cell.trim() !== "")) rows.push(current);
						current = [];
						continue;
					}

					value += ch;
				}

				if (value.length > 0 || current.length > 0) {
					current.push(value);
					if (current.some((cell) => cell.trim() !== "")) rows.push(current);
				}

				const headers = rows.shift().map((h) => h.trim());
				return rows.map((r) => {
					const obj = {};
					headers.forEach((h, idx) => {
						obj[h] = (r[idx] ?? "").trim();
					});
					return obj;
				});
			}

			function parseMonthDay(md) {
				const [m, d] = md.split("/").map((x) => Number(x));
				// 2026
				return new Date(2026, m - 1, d);
			}

			function weekdayShort(date) {
				return new Intl.DateTimeFormat("zh-TW", { weekday: "short" }).format(date);
			}

			function formatDayTitle(md, dayIndex) {
				const dt = parseMonthDay(md);
				return `${md} (${weekdayShort(dt)}) | Day ${dayIndex}`;
			}

			function normalizeType(type) {
				const t = type.trim();
				if (t === "æ™¯é»") return { cls: "sight", label: "ğŸ“ æ™¯é»" };
				if (t === "é¤å»³") return { cls: "food", label: "ğŸ´ é¤å»³" };
				if (t === "äº¤é€š") return { cls: "transit", label: "ğŸš† äº¤é€š" };
				if (t === "ä½å®¿") return { cls: "stay", label: "ğŸ¨ ä½å®¿" };
				if (t === "è³¼ç‰©") return { cls: "shop", label: "ğŸ›ï¸ è³¼ç‰©" };
				return { cls: "other", label: `â€¢ ${t || "å…¶ä»–"}` };
			}

			function escapeHtml(s) {
				return String(s)
					.replaceAll("&", "&amp;")
					.replaceAll("<", "&lt;")
					.replaceAll(">", "&gt;")
					.replaceAll('"', "&quot;");
			}

			function normalizeFoodTag(raw) {
				const t = String(raw || "").trim();
				if (t.includes("ğŸ¨")) return { key: "stay", cls: "stay", label: "ğŸ¨ ä½å®¿" };
				if (t.includes("ğŸ¤˜") || t.includes("åƒé£¯é£¯")) return { key: "food", cls: "food", label: "ğŸ´ åƒé£¯é£¯" };
				if (t.includes("ğŸƒ") || t.includes("æ™¯é»")) return { key: "sight", cls: "sight", label: "ğŸ“ æ™¯é»" };
				return { key: "other", cls: "other", label: "â€¢ å…¶ä»–" };
			}

			function normalizeFoodItem(obj) {
				const title = String(obj["æ¨™é¡Œ"] || "").trim();
				const note = String(obj["ç­†è¨˜"] || "").trim();
				const url = String(obj["ç¶²å€"] || "").trim();
				const tagRaw = String(obj["æ¨™ç±¤"] || "").trim();
				const comment = String(obj["ç•™è¨€"] || "").trim();
				return { title, note, url, tagRaw, comment };
			}

			const FOOD_PLACES = ["äº¬éƒ½", "å¤§é˜ª", "å®‡æ²»", "å¥ˆè‰¯"];
			const FOOD_PLACE_KEY = "kansai_food_place_v1";
			let FOOD_PLACE_SELECTED = "äº¬éƒ½";

			function inferFoodPlace(it) {
				const text = `${it.title || ""} ${it.note || ""} ${it.url || ""}`.toLowerCase();
				if (text.includes("å®‡æ²»") || text.includes("uji")) return "å®‡æ²»";
				if (
					text.includes("å¥ˆè‰¯") ||
					text.includes("nara") ||
					text.includes("æ˜¥æ—¥") ||
					text.includes("æ±å¤§å¯º") ||
					text.includes("todai") ||
					text.includes("tÅdai")
				)
					return "å¥ˆè‰¯";
				if (
					text.includes("å¤§é˜ª") ||
					text.includes("osaka") ||
					text.includes("é›£æ³¢") ||
					text.includes("namba") ||
					text.includes("å¿ƒé½‹æ©‹") ||
					text.includes("shinsaibashi") ||
					text.includes("é“é “å €") ||
					text.includes("dotonbori") ||
					text.includes("æ–°ä¸–ç•Œ") ||
					text.includes("shinsekai") ||
					text.includes("æ¢…ç”°") ||
					text.includes("umeda") ||
					text.includes("amerikamura")
				)
					return "å¤§é˜ª";
				if (
					text.includes("äº¬éƒ½") ||
					text.includes("kyoto") ||
					text.includes("åµå±±") ||
					text.includes("arashiyama") ||
					text.includes("å››æ¢") ||
					text.includes("shijo") ||
					text.includes("æ¸…æ°´") ||
					text.includes("ä¼è¦‹") ||
					text.includes("éŒ¦")
				)
					return "äº¬éƒ½";
				return "äº¬éƒ½";
			}

			function loadFoodPlaceDefault() {
				const saved = localStorage.getItem(FOOD_PLACE_KEY);
				if (saved && FOOD_PLACES.includes(saved)) return saved;
				return "äº¬éƒ½";
			}

			function setFoodPlace(place) {
				if (!FOOD_PLACES.includes(place)) return;
				FOOD_PLACE_SELECTED = place;
				localStorage.setItem(FOOD_PLACE_KEY, place);
				renderFoodPlaceTabs(place);
				renderFood(FOOD_ITEMS_CACHE, place);
			}

			function renderFoodPlaceTabs(selectedPlace) {
				const tabs = document.getElementById("foodPlaceTabs");
				if (!tabs) return;
				tabs.innerHTML = "";
				FOOD_PLACES.forEach((place) => {
					const btn = document.createElement("button");
					btn.type = "button";
					btn.className = "day-tab";
					btn.setAttribute("role", "tab");
					btn.setAttribute("data-place", place);
					btn.setAttribute("aria-selected", place === selectedPlace ? "true" : "false");
					btn.textContent = `ğŸ“${place}`;
					btn.addEventListener("click", () => setFoodPlace(place));
					tabs.appendChild(btn);
				});
			}

			function dedupeFoodItems(items) {
				const byKey = new Map();
				for (const it of items) {
					const titleKey = it.title
						.normalize("NFKC")
						.replaceAll(/[\s\u3000]+/g, " ")
						.trim()
						.toLowerCase();
					const urlKey = (it.url || "").trim().toLowerCase();
					const key = titleKey || urlKey;
					if (!key) continue;
					const normalized = { ...it, _key: key };

					if (!byKey.has(key)) {
						byKey.set(key, normalized);
						continue;
					}

					const prev = byKey.get(key);
					// Merge: keep the most informative fields.
					prev.url = prev.url || normalized.url;
					prev.tagRaw = prev.tagRaw || normalized.tagRaw;
					prev.comment = prev.comment || normalized.comment;
					if ((normalized.note || "").length > (prev.note || "").length) prev.note = normalized.note;
					byKey.set(key, prev);
				}
				return Array.from(byKey.values());
			}

			const FOOD_PINNED_KEY = "kansai_food_pinned_v1";
			let FOOD_PINNED_CACHE = {};
			const FOOD_PINNED_ORDER_KEY = "kansai_food_pinned_order_v1";
			let FOOD_PINNED_ORDER_CACHE = {};

			function loadFoodPinned() {
				try {
					const raw = localStorage.getItem(FOOD_PINNED_KEY);
					if (!raw) return {};
					const parsed = JSON.parse(raw);
					return parsed && typeof parsed === "object" ? parsed : {};
				} catch {
					return {};
				}
			}

			function saveFoodPinned(pinned) {
				localStorage.setItem(FOOD_PINNED_KEY, JSON.stringify(pinned || {}));
			}

			function loadFoodPinnedOrder() {
				try {
					const raw = localStorage.getItem(FOOD_PINNED_ORDER_KEY);
					if (!raw) return {};
					const parsed = JSON.parse(raw);
					return parsed && typeof parsed === "object" ? parsed : {};
				} catch {
					return {};
				}
			}

			function saveFoodPinnedOrder(orderByPlace) {
				localStorage.setItem(FOOD_PINNED_ORDER_KEY, JSON.stringify(orderByPlace || {}));
			}

			function getPinnedOrderForPlace(place) {
				const arr = FOOD_PINNED_ORDER_CACHE?.[place];
				return Array.isArray(arr) ? arr.filter((x) => typeof x === "string") : [];
			}

			function setPinnedOrderForPlace(place, order) {
				if (!FOOD_PLACES.includes(place)) return;
				FOOD_PINNED_ORDER_CACHE[place] = (order || []).filter((x) => typeof x === "string");
				saveFoodPinnedOrder(FOOD_PINNED_ORDER_CACHE);
			}

			function isFoodPinned(key) {
				return !!(key && FOOD_PINNED_CACHE && FOOD_PINNED_CACHE[key]);
			}

			function toggleFoodPinned(key) {
				if (!key) return;
				if (isFoodPinned(key)) delete FOOD_PINNED_CACHE[key];
				else FOOD_PINNED_CACHE[key] = true;
				saveFoodPinned(FOOD_PINNED_CACHE);
			}

			function wireFoodPinned() {
				const root = document.getElementById("foodRoot");
				if (!root) return;
				root.addEventListener("click", (e) => {
					const btn = e.target.closest("button[data-pin]");
					if (!btn) return;
					const key = btn.getAttribute("data-pin") || "";
					toggleFoodPinned(key);
					renderFood(FOOD_ITEMS_CACHE, FOOD_PLACE_SELECTED);
				});
			}

			function wirePinnedSort() {
				const root = document.getElementById("foodRoot");
				if (!root) return;

				let draggingKey = "";
				let touchDraggingEl = null;
				let touchPlace = "";

				const getPinnedList = () => document.getElementById("foodPinnedList");
				const saveOrderFromDom = (place) => {
					const list = getPinnedList();
					if (!list) return;
					const keys = Array.from(list.querySelectorAll(".card[data-pin-key]"))
						.map((el) => el.getAttribute("data-pin-key") || "")
						.filter(Boolean);
					setPinnedOrderForPlace(place, keys);
				};

				const reorderByPointer = (list, draggedEl, overEl, clientY) => {
					if (!list || !draggedEl || !overEl || draggedEl === overEl) return;
					const r = overEl.getBoundingClientRect();
					const before = clientY < r.top + r.height / 2;
					list.insertBefore(draggedEl, before ? overEl : overEl.nextSibling);
				};

				// Mouse / Desktop drag & drop
				root.addEventListener("dragstart", (e) => {
					const card = e.target.closest(".card[data-pin-key]");
					const list = getPinnedList();
					if (!card || !list || !list.contains(card)) return;
					draggingKey = card.getAttribute("data-pin-key") || "";
					card.classList.add("dragging");
					e.dataTransfer?.setData("text/plain", draggingKey);
					e.dataTransfer && (e.dataTransfer.effectAllowed = "move");
				});

				root.addEventListener("dragend", (e) => {
					const card = e.target.closest(".card[data-pin-key]");
					if (card) card.classList.remove("dragging");
					draggingKey = "";
				});

				root.addEventListener("dragover", (e) => {
					const list = getPinnedList();
					if (!list) return;
					const overEl = e.target.closest(".card[data-pin-key]");
					const draggedEl = list.querySelector(`.card[data-pin-key="${CSS.escape(draggingKey)}"]`);
					if (!overEl || !draggedEl || !list.contains(overEl)) return;
					e.preventDefault();
					reorderByPointer(list, draggedEl, overEl, e.clientY);
				});

				root.addEventListener("drop", (e) => {
					const list = getPinnedList();
					if (!list) return;
					e.preventDefault();
					const place = list.getAttribute("data-place") || FOOD_PLACE_SELECTED;
					saveOrderFromDom(place);
				});

				// Touch drag (mobile)
				root.addEventListener(
					"touchstart",
					(e) => {
						const list = getPinnedList();
						if (!list) return;
						const card = e.target.closest(".card[data-pin-key]");
						if (!card || !list.contains(card)) return;
						touchDraggingEl = card;
						touchPlace = list.getAttribute("data-place") || FOOD_PLACE_SELECTED;
						card.classList.add("dragging");
					},
					{ passive: true }
				);

				root.addEventListener(
					"touchmove",
					(e) => {
						const list = getPinnedList();
						if (!list || !touchDraggingEl) return;
						const t = e.touches?.[0];
						if (!t) return;
						e.preventDefault();
						const el = document.elementFromPoint(t.clientX, t.clientY);
						const overEl = el?.closest?.(".card[data-pin-key]") || null;
						if (!overEl || !list.contains(overEl)) return;
						reorderByPointer(list, touchDraggingEl, overEl, t.clientY);
					},
					{ passive: false }
				);

				root.addEventListener(
					"touchend",
					() => {
						if (touchDraggingEl) touchDraggingEl.classList.remove("dragging");
						if (touchPlace) saveOrderFromDom(touchPlace);
						touchDraggingEl = null;
						touchPlace = "";
					},
					{ passive: true }
				);
			}

			const FOOD_NOTES_KEY = "kansai_food_notes_v1";
			let FOOD_NOTES_CACHE = {};

			function loadFoodNotes() {
				try {
					const raw = localStorage.getItem(FOOD_NOTES_KEY);
					if (!raw) return {};
					const parsed = JSON.parse(raw);
					return parsed && typeof parsed === "object" ? parsed : {};
				} catch {
					return {};
				}
			}

			function saveFoodNotes(notes) {
				localStorage.setItem(FOOD_NOTES_KEY, JSON.stringify(notes || {}));
			}

			function getFoodNote(key) {
				if (!key) return "";
				const v = FOOD_NOTES_CACHE[key];
				return typeof v === "string" ? v : "";
			}

			function setFoodNote(key, value) {
				if (!key) return;
				const v = String(value || "");
				if (!v.trim()) {
					delete FOOD_NOTES_CACHE[key];
				} else {
					FOOD_NOTES_CACHE[key] = v;
				}
				saveFoodNotes(FOOD_NOTES_CACHE);
			}

			function wireFoodNotes() {
				const root = document.getElementById("foodRoot");
				if (!root) return;

				const timers = new Map();
				const saveSoon = (key, value) => {
					if (timers.has(key)) clearTimeout(timers.get(key));
					timers.set(
						key,
						setTimeout(() => {
							setFoodNote(key, value);
						}, 250)
					);
				};

				root.addEventListener("input", (e) => {
					const ta = e.target.closest("textarea.note-input");
					if (!ta) return;
					const key = ta.getAttribute("data-food-note") || "";
					saveSoon(key, ta.value);
				});

				root.addEventListener("blur", (e) => {
					const ta = e.target.closest("textarea.note-input");
					if (!ta) return;
					const key = ta.getAttribute("data-food-note") || "";
					setFoodNote(key, ta.value);
				}, true);
			}

			let FOOD_ITEMS_CACHE = [];

			function renderFood(foodItems, selectedPlace) {
				const root = document.getElementById("foodRoot");
				if (!root) return;
				const place = FOOD_PLACES.includes(selectedPlace) ? selectedPlace : "äº¬éƒ½";
				const filtered = (foodItems || []).filter((x) => x.place === place);
				const pinnedOrder = getPinnedOrderForPlace(place);
				const pinnedItems = filtered.filter((x) => isFoodPinned(x._key)).slice();
				const pinnedIndex = new Map(pinnedOrder.map((k, i) => [k, i]));
				pinnedItems.sort((a, b) => {
					const ai = pinnedIndex.has(a._key) ? pinnedIndex.get(a._key) : 1e9;
					const bi = pinnedIndex.has(b._key) ? pinnedIndex.get(b._key) : 1e9;
					if (ai !== bi) return ai - bi;
					return (a.title || "").localeCompare(b.title || "");
				});
				const unpinnedItems = filtered
					.filter((x) => !isFoodPinned(x._key))
					.slice();

				const groupsOrder = ["food", "stay", "sight", "other"];
				const groups = new Map();
				for (const it of unpinnedItems) {
					const tag = normalizeFoodTag(it.tagRaw);
					if (!groups.has(tag.key)) groups.set(tag.key, []);
					groups.get(tag.key).push({ ...it, tag });
				}
				for (const arr of groups.values()) {
					arr.sort((a, b) => (a.title || "").localeCompare(b.title || ""));
				}

				const total = filtered.length;
				root.innerHTML = `
					<div class="hint-note">å·²æ•´ç† ${escapeHtml(
						String(total)
					)} ç­†æ”¶è—ï¼ˆ${escapeHtml(`ğŸ“${place}`)}ï¼‰ã€‚ç­†è¨˜å¯ç›´æ¥ç·¨è¼¯ä¸¦è‡ªå‹•ä¿å­˜ï¼›æŒ‰ã€Œâ­ ç½®é ‚ã€æœƒå‡ºç¾åœ¨æœ¬é æœ€ä¸Šæ–¹ã€‚</div>
					<div class="tool-grid">
						${
							pinnedItems.length
								? `
									<section class="tool-card">
										<div class="section-title">â­ ç½®é ‚ï¼ˆ${escapeHtml(
											String(pinnedItems.length)
										)}ï¼‰<span class="hint-note" style="margin-left:8px;">ï¼ˆå¯æ‹–æ›³èª¿æ•´é †åºï¼‰</span></div>
										<div class="items" id="foodPinnedList" data-place="${escapeHtml(place)}">
											${pinnedItems
												.map((it) => {
													const safeTitle = escapeHtml(it.title || "-");
													const map = it.url || mapUrl(it.title, "");
													const note = getFoodNote(it._key) || it.note || "";
													const comment = it.comment || "";
													const noteSummary = note.trim() ? "ï¼ˆå¯ç·¨è¼¯ï¼Œè‡ªå‹•ä¿å­˜ï¼‰" : "ï¼ˆå¯ç·¨è¼¯ï¼‰";
													const placeBadge = `ğŸ“${it.place || place}`;
													return `
														<article class="card" draggable="true" data-pin-key="${escapeHtml(
															it._key
														)}">
															<div class="card-top">
																<div>
																	<div class="time">${escapeHtml(placeBadge)}ï½œç½®é ‚</div>
																	<div class="name">${safeTitle}</div>
																</div>
																<div class="tag ${escapeHtml(
																	normalizeFoodTag(it.tagRaw).cls
																)}">${escapeHtml(normalizeFoodTag(it.tagRaw).label)}</div>
															</div>

														<div class="card-body">
															${
																comment
																	? `<div class="row"><div class="k">ç•™è¨€</div><div class="v">${escapeHtml(
																		comment
																	)}</div></div>`
																	: ""
															}

															<details class="story">
																<summary>ç­†è¨˜ <span class="hint">${escapeHtml(noteSummary)}</span></summary>
																<textarea class="note-input" data-food-note="${escapeHtml(
																	titleKeyOrUrl(it)
																)}" placeholder="åœ¨é€™è£¡è£œå……ç­†è¨˜â€¦">${escapeHtml(
																	note
																)}</textarea>
															</details>

															<div class="actions">
																<button class="btn" type="button" data-pin="${escapeHtml(
																	it._key
																)}">â­ å·²ç½®é ‚</button>
																<a class="btn primary" href="${escapeHtml(
																	map
																)}" target="_blank" rel="noopener noreferrer">ğŸ—ºï¸ åœ°åœ–</a>
															</div>
														</div>
													</article>
												`;
											})
												.join("")}
										</div>
									</section>
								`
								: ""
						}
						${groupsOrder
							.filter((k) => (groups.get(k) || []).length > 0)
							.map((k) => {
								const arr = groups.get(k) || [];
								const anyTag = arr[0]?.tag || normalizeFoodTag(k);
								return `
									<section class="tool-card">
										<div class="section-title">${escapeHtml(anyTag.label)}ï¼ˆ${escapeHtml(
											String(arr.length)
										)}ï¼‰</div>
										<div class="items">
											${arr
												.map((it) => {
													const safeTitle = escapeHtml(it.title || "-");
													const map = it.url || mapUrl(it.title, "");
													const note = getFoodNote(it._key) || it.note || "";
													const comment = it.comment || "";
													const noteSummary = note.trim() ? "ï¼ˆå¯ç·¨è¼¯ï¼Œè‡ªå‹•ä¿å­˜ï¼‰" : "ï¼ˆå¯ç·¨è¼¯ï¼‰";
														const placeBadge = `ğŸ“${it.place || place}`;
														const pinned = isFoodPinned(it._key);
													return `
														<article class="card">
															<div class="card-top">
																<div>
																		<div class="time">${escapeHtml(placeBadge)}ï½œæ”¶è—</div>
																	<div class="name">${safeTitle}</div>
																</div>
																<div class="tag ${escapeHtml(it.tag.cls)}">${escapeHtml(it.tag.label)}</div>
														</div>

														<div class="card-body">
															${
																comment
																	? `<div class="row"><div class="k">ç•™è¨€</div><div class="v">${escapeHtml(
																		comment
																	)}</div></div>`
																	: ""
															}

															<details class="story">
																<summary>ç­†è¨˜ <span class="hint">${escapeHtml(noteSummary)}</span></summary>
																<textarea class="note-input" data-food-note="${escapeHtml(
																	titleKeyOrUrl(it)
																)}" placeholder="åœ¨é€™è£¡è£œå……ç­†è¨˜â€¦">${escapeHtml(
																	note
																)}</textarea>
															</details>

															<div class="actions">
																<button class="btn" type="button" data-pin="${escapeHtml(
																	it._key
																)}">${pinned ? "â­ å·²ç½®é ‚" : "â˜† ç½®é ‚"}</button>
																<a class="btn primary" href="${escapeHtml(map)}" target="_blank" rel="noopener noreferrer">ğŸ—ºï¸ åœ°åœ–</a>
															</div>
														</div>
													</article>
												`;
											})
												.join("")}
										</div>
									</section>
								`;
							})
							.join("")}
					</div>
				`;
			}

			function titleKeyOrUrl(it) {
				return it?._key || "";
			}

			function extractGuidePills(note) {
				const pills = [];
				const re = /ã€(å¿…åƒ|å¿…é»|å¿…è²·|é ç´„)ã€‘([^ã€ã€‘]+)/g;
				let m;
				while ((m = re.exec(note)) !== null) {
					const kind = m[1];
					const raw = (m[2] || "").trim();
					const main = raw.split(/ï¼›|ï¼Œ|ã€‚|\(|\)|\s{2,}/)[0].trim();
					if (!main) continue;
					if (kind === "å¿…åƒ") pills.push({ cls: "must-eat", text: `å¿…åƒï¼š${main}` });
					if (kind === "å¿…é»") pills.push({ cls: "must-order", text: `å¿…é»ï¼š${main}` });
					if (kind === "å¿…è²·") pills.push({ cls: "must-buy", text: `å¿…è²·ï¼š${main}` });
					if (kind === "é ç´„") pills.push({ cls: "reserve", text: `é ç´„ï¼š${main}` });
				}
				return pills;
			}

			function mapUrl(name, address) {
				const q = [name, address].filter(Boolean).join(" ");
				const url = new URL("https://www.google.com/maps/search/");
				url.searchParams.set("api", "1");
				url.searchParams.set("query", q);
				return url.toString();
			}

			const SELECTED_DAY_KEY = "kansai_selected_day_v1";
			let DAYS_CACHE = [];

			function getDefaultSelectedDay(days) {
				const saved = localStorage.getItem(SELECTED_DAY_KEY);
				if (saved && days.some((d) => d.md === saved)) return saved;
				return days[0]?.md || "";
			}

			function renderDayTabs(days, selectedMd) {
				const tabs = document.getElementById("dayTabs");
				tabs.innerHTML = "";

				days.forEach((day) => {
					const btn = document.createElement("button");
					btn.type = "button";
					btn.className = "day-tab";
					btn.setAttribute("role", "tab");
					btn.setAttribute("data-md", day.md);
					btn.setAttribute("aria-selected", day.md === selectedMd ? "true" : "false");
					btn.textContent = `${day.md}ï½œDay ${day.dayIndex}`;
					btn.addEventListener("click", () => setSelectedDay(day.md));
					tabs.appendChild(btn);
				});
			}

			function applySelectedDayToUI(selectedMd) {
				document.querySelectorAll("#dailyRoot .day").forEach((dayEl) => {
					dayEl.style.display = dayEl.getAttribute("data-md") === selectedMd ? "block" : "none";
				});

				document.querySelectorAll("#dayTabs .day-tab").forEach((tab) => {
					tab.setAttribute(
						"aria-selected",
						tab.getAttribute("data-md") === selectedMd ? "true" : "false"
					);
				});

				const active = Array.from(document.querySelectorAll("#dayTabs .day-tab")).find(
					(x) => x.getAttribute("data-md") === selectedMd
				);
				active?.scrollIntoView?.({ behavior: "smooth", inline: "center", block: "nearest" });
				window.scrollTo({ top: 0, behavior: "smooth" });
			}

			function setSelectedDay(md) {
				if (!md || !DAYS_CACHE.some((d) => d.md === md)) return;
				localStorage.setItem(SELECTED_DAY_KEY, md);
				applySelectedDayToUI(md);
			}

			function renderDaily(days, selectedMd) {
				const root = document.getElementById("dailyRoot");
				root.innerHTML = "";

					days.forEach((day) => {
					const weatherId = `wx-${day.md.replace("/", "-")}`;
					const header = document.createElement("div");
					header.className = "day-header";
					header.innerHTML = `
						<div class="day-title">
							<div class="left">
								<div class="date">${escapeHtml(formatDayTitle(day.md, day.dayIndex))}</div>
								<div class="meta">ä¸»è¦åœ°é»ï¼š${escapeHtml(day.city)}ï½œ${escapeHtml(day.summary)}</div>
							</div>
							<div class="weather" id="${weatherId}">
								<div class="wx-icon" aria-hidden="true">â€¦</div>
								<div class="wx-text">
									<div class="t">è®€å–å¤©æ°£ä¸­</div>
									<div class="d">è«‹ç¨å€™</div>
									<div class="wx-source">ä¾†æºï¼š-</div>
								</div>
							</div>
						</div>
					`;

					const itemsWrap = document.createElement("div");
					itemsWrap.className = "items";

					day.items.forEach((it) => {
						const type = normalizeType(it["é¡å‹"]);
						const note = it["å‚™è¨»/æ”»ç•¥"] || "";
						const pills = extractGuidePills(note);
						const address = it["åœ°å€/åœ°é»"] && it["åœ°å€/åœ°é»"] !== "-" ? it["åœ°å€/åœ°é»"] : "";
						const fee = it["è²»ç”¨"] && it["è²»ç”¨"] !== "-" ? it["è²»ç”¨"] : "-";
						const story = STORY[it["åç¨±"]] || "";

						const card = document.createElement("article");
						card.className = "card";
						card.innerHTML = `
							<div class="card-top">
								<span class="tag ${type.cls}">${escapeHtml(type.label)}</span>
								<span class="time">${escapeHtml(it["æ™‚é–“"])}</span>
							</div>
							<div class="card-body">
								<div class="name">${escapeHtml(it["åç¨±"])}</div>
								<div class="row"><div class="k">å…§å®¹</div><div class="v">${escapeHtml(it["è©³ç´°è³‡è¨Š"])}</div></div>
								<div class="row"><div class="k">è²»ç”¨</div><div class="v">${escapeHtml(fee)}</div></div>
								<div class="row"><div class="k">åœ°é»</div><div class="v">${escapeHtml(address || "ï¼ˆä»¥åç¨±å°èˆªï¼‰")}</div></div>
								${
									pills.length
										? `<div class="guide">${pills
												.map(
													(p) =>
														`<span class="pill ${p.cls}">${escapeHtml(p.text)}</span>`
												)
												.join("")}</div>`
										: ""
								}
								${
									story
										? `<details class="story"><summary>å°æ•…äº‹ / å°è²¼å£«<span class="hint">é»æˆ‘å±•é–‹</span></summary><p>${escapeHtml(
												story
											)}</p></details>`
										: ""
								}
								<div class="actions">
									<a class="btn primary" href="${escapeHtml(
										mapUrl(it["åç¨±"], address)
									)}" target="_blank" rel="noopener">ğŸ§­ å°èˆª</a>
								</div>
								${
									note && note !== "-"
										? `<div class="row"><div class="k">å‚™è¨»</div><div class="v">${escapeHtml(
												note
											)}</div></div>`
										: ""
								}
							</div>
						`;
						itemsWrap.appendChild(card);
					});

						const dayWrap = document.createElement("section");
						dayWrap.className = "day";
						dayWrap.setAttribute("data-md", day.md);
						dayWrap.style.display = day.md === selectedMd ? "block" : "none";
					dayWrap.appendChild(header);
					dayWrap.appendChild(itemsWrap);
					root.appendChild(dayWrap);

					// Weather async
					getWeatherForCity(day.city)
						.then((wx) => {
							const el = document.getElementById(weatherId);
							if (!el) return;
							el.innerHTML = `
								<div class="wx-icon" aria-hidden="true">${escapeHtml(wx.icon)}</div>
								<div class="wx-text">
									<div class="t">${escapeHtml(day.city)}ï½œ${escapeHtml(wx.text)}</div>
									<div class="d">${escapeHtml(String(wx.lo))}Â°C â€“ ${escapeHtml(
								String(wx.hi)
							)}Â°Cï½œé™é›¨ ${escapeHtml(String(wx.rain))}%</div>
									<div class="wx-source">ä¾†æºï¼š${escapeHtml(wx.source)}</div>
								</div>
							`;
						})
						.catch(() => {
							const el = document.getElementById(weatherId);
							if (!el) return;
							el.innerHTML = `
								<div class="wx-icon" aria-hidden="true">âš ï¸</div>
								<div class="wx-text">
									<div class="t">å¤©æ°£è¼‰å…¥å¤±æ•—</div>
									<div class="d">è«‹ç¨å¾Œå†è©¦</div>
									<div class="wx-source">ä¾†æºï¼šWeatherAPI</div>
								</div>
							`;
						});
				});
			}

			// === Tools page ===
			const TOOLBOX = {
				flights: {
					out: {
						flightNo: "D7378",
						airline: "AirAsia X",
						from: "æ¡ƒåœ’ (TPE)",
						to: "é—œè¥¿ (KIX)",
						dep: "4/16 15:40",
						arr: "4/16 19:20",
						terminalGate: "ä»¥ç•¶æ—¥å…¬å‘Šç‚ºæº–",
					},
					back: {
						flightNo: "D7379",
						airline: "AirAsia X",
						from: "é—œè¥¿ (KIX)",
						to: "æ¡ƒåœ’ (TPE)",
						dep: "4/22 20:55",
						arr: "4/22 22:55",
						terminalGate: "KIX ç¬¬ä¸€èˆªå»ˆï¼ˆT1ï¼‰B7ï¼ˆç­†è¨˜ï¼‰ï½œå…¶é¤˜ä»¥ç•¶æ—¥å…¬å‘Šç‚ºæº–",
					},
				},
				hotels: [
					{
						name: "CheckIn Hotel å››æ¢çƒä¸¸",
						address: "äº¬éƒ½å¸‚ä¸­äº¬åŒºæ‰‹æ´—æ°´ç”º654-2",
						stay: "4/16 â†’ 4/19ï¼ˆ3æ™šï¼‰",
						checkin: "14:00 å¾Œ",
						checkout: "11:00 å‰",
						note: "åœ°éµ 21 è™Ÿå‡ºå£æ­¥è¡Œç´„ 2 åˆ†é˜ï¼›1F æœ‰ Lawson",
					},
					{
						name: "ZONE å¿ƒé½‹æ©‹è¥¿å€",
						address: "å¤§é˜ªå¸‚è¥¿åŒºç«‹å£²å €1-10-2",
						stay: "4/19 â†’ 4/22ï¼ˆ3æ™šï¼‰",
						checkin: "ä»¥è¨‚æˆ¿ç¢ºèªç‚ºæº–",
						checkout: "ä»¥è¨‚æˆ¿ç¢ºèªç‚ºæº–",
						note: "æœ¬ç”ºç«™/å¿ƒé½‹æ©‹ç«™æ­¥è¡Œå¯é”",
					},
				],
				emergency: {
					jp: [
						{ label: "è­¦å¯Ÿ", value: "110" },
						{ label: "æ•‘è­·è»Š/æ¶ˆé˜²", value: "119" },
					],
					placeholders: [
						{ label: "å°ç£é§æ—¥è¾¦äº‹è™•ï¼ˆè«‹å¡«ï¼‰", value: "â€”" },
						{ label: "ä¿¡ç”¨å¡æµ·å¤–æ›å¤±ï¼ˆè«‹å¡«ï¼‰", value: "â€”" },
					],
				},
				budget: {
					paid: [
						{ name: "æ©Ÿç¥¨", amountTwd: 6396 },
						{ name: "å¤§é˜ªä½å®¿", amountTwd: 1818 },
						{ name: "äº¬éƒ½ä½å®¿", amountTwd: 2863 },
					],
				},
			};

			const LEDGER_KEY = "kansai_ledger_v1";
			const HOTEL_BOOKING_KEY = "kansai_hotel_booking_v1";

			function loadHotelBooking() {
				try {
					const raw = localStorage.getItem(HOTEL_BOOKING_KEY);
					if (!raw) return {};
					const parsed = JSON.parse(raw);
					return parsed && typeof parsed === "object" ? parsed : {};
				} catch {
					return {};
				}
			}

			function saveHotelBooking(state) {
				localStorage.setItem(HOTEL_BOOKING_KEY, JSON.stringify(state || {}));
			}

			function loadLedger() {
				try {
					const raw = localStorage.getItem(LEDGER_KEY);
					if (!raw) return [];
					const parsed = JSON.parse(raw);
					return Array.isArray(parsed) ? parsed : [];
				} catch {
					return [];
				}
			}

			function saveLedger(rows) {
				localStorage.setItem(LEDGER_KEY, JSON.stringify(rows));
			}

			function sumBudgetTwd() {
				return TOOLBOX.budget.paid.reduce((a, b) => a + (b.amountTwd || 0), 0);
			}

			function money(n) {
				return new Intl.NumberFormat("zh-TW").format(n);
			}

			function renderTools(ledgerRows) {
				const root = document.getElementById("toolsRoot");
				const f = TOOLBOX.flights;
				const hotels = TOOLBOX.hotels;
				const hotelBooking = loadHotelBooking();
				const emergency = TOOLBOX.emergency;
				const budget = TOOLBOX.budget;

				root.innerHTML = `
					<section class="tool-card">
						<div class="section-title">âœˆï¸ èˆªç­è³‡è¨Š</div>
						<div class="kv">
							<div class="line"><div class="k">å»ç¨‹</div><div class="v">${escapeHtml(
								`${f.out.airline} ${f.out.flightNo}`
							)}</div></div>
							<div class="line"><div class="k">æ™‚é–“</div><div class="v">${escapeHtml(
								`${f.out.dep} â†’ ${f.out.arr}`
							)}</div></div>
							<div class="line"><div class="k">èˆªç·š</div><div class="v">${escapeHtml(
								`${f.out.from} â†’ ${f.out.to}`
							)}</div></div>
							<div class="line"><div class="k">èˆªå»ˆ/ç™»æ©Ÿé–€</div><div class="v">${escapeHtml(
								f.out.terminalGate
							)}</div></div>
							<div class="line"><div class="k">å›ç¨‹</div><div class="v">${escapeHtml(
								`${f.back.airline} ${f.back.flightNo}`
							)}</div></div>
							<div class="line"><div class="k">æ™‚é–“</div><div class="v">${escapeHtml(
								`${f.back.dep} â†’ ${f.back.arr}`
							)}</div></div>
							<div class="line"><div class="k">èˆªç·š</div><div class="v">${escapeHtml(
								`${f.back.from} â†’ ${f.back.to}`
							)}</div></div>
							<div class="line"><div class="k">èˆªå»ˆ/ç™»æ©Ÿé–€</div><div class="v">${escapeHtml(
								f.back.terminalGate
							)}</div></div>
						</div>
						<div class="small">å»ºè­°å›ç¨‹è‡³å°‘æå‰ 3 å°æ™‚åˆ°æ©Ÿå ´è¾¦ç†ç™»æ©Ÿã€‚</div>
					</section>

					<section class="tool-card">
						<div class="section-title">ğŸ¨ ä½å®¿è³‡è¨Š</div>
						${hotels
							.map((h, idx) => {
								const b = (hotelBooking && hotelBooking[idx]) || {};
								const orderNo = typeof b.orderNo === "string" ? b.orderNo : "";
								const pin = typeof b.pin === "string" ? b.pin : "";
								return `
									<div class="hotel-box" data-hotel-box="${idx}">
										<div class="hotel-name">${escapeHtml(h.name)}</div>
										<div class="hotel-stay">ä½å®¿æœŸé–“ï¼š${escapeHtml(h.stay || "")}</div>
										<div class="kv">
											<div class="line"><div class="k">åœ°å€</div><div class="v">${escapeHtml(
												h.address
											)}</div></div>
											<div class="line"><div class="k">Check-in</div><div class="v">${escapeHtml(
												h.checkin
											)}</div></div>
											<div class="line"><div class="k">Check-out</div><div class="v">${escapeHtml(
												h.checkout
											)}</div></div>
											<div class="line"><div class="k">å‚™è¨»</div><div class="v">${escapeHtml(
												h.note
											)}</div></div>
										</div>
										<div class="hotel-fields">
											<label>
												è¨‚å–®ç·¨è™Ÿ
												<input type="text" autocomplete="off" placeholder="è‡ªè¡Œå¡«å¯«" data-hotel-idx="${idx}" data-hotel-field="orderNo" value="${escapeHtml(
													orderNo
												)}" />
											</label>
											<label>
												PINç¢¼
												<input type="text" autocomplete="off" placeholder="è‡ªè¡Œå¡«å¯«" data-hotel-idx="${idx}" data-hotel-field="pin" value="${escapeHtml(
													pin
												)}" />
											</label>
										</div>
									</div>
								`;
							})
							.join("")}
					</section>

					<section class="tool-card">
						<div class="section-title">ğŸ“ ç·Šæ€¥è¯çµ¡</div>
						<div class="kv">
							${emergency.jp
								.map(
									(x) =>
										`<div class="line"><div class="k">${escapeHtml(
											x.label
										)}</div><div class="v">${escapeHtml(x.value)}</div></div>`
								)
								.join("")}
							${emergency.placeholders
								.map(
									(x) =>
										`<div class="line"><div class="k">${escapeHtml(
											x.label
										)}</div><div class="v">${escapeHtml(x.value)}</div></div>`
								)
								.join("")}
						</div>
						<div class="small">æç¤ºï¼šå¯æŠŠå¸¸ç”¨é›»è©±æ”¹æˆè‡ªå·±çš„ç‰ˆæœ¬ï¼ˆç›´æ¥æ”¹æœ¬æª”æ¡ˆï¼‰ã€‚</div>
					</section>

					<section class="tool-card">
						<div class="section-title">ğŸ’° é ç®—èˆ‡è¨˜å¸³è¡¨</div>
						<div class="kv">
							${budget.paid
								.map(
									(x) =>
										`<div class="line"><div class="k">å·²ä»˜ï¼š${escapeHtml(
											x.name
										)}</div><div class="v">TWD ${escapeHtml(
											money(x.amountTwd)
										)}</div></div>`
								)
								.join("")}
							<div class="line"><div class="k">åˆè¨ˆ</div><div class="v">TWD ${escapeHtml(
								money(sumBudgetTwd())
							)}</div></div>
						</div>

						<div class="ledger">
							<form id="ledgerForm" autocomplete="off">
								<label>
									æ—¥æœŸ
									<input name="date" type="date" required />
								</label>
								<label>
									é¡åˆ¥
									<select name="category" required>
										<option value="äº¤é€š">äº¤é€š</option>
										<option value="é¤é£²">é¤é£²</option>
										<option value="æ™¯é»">æ™¯é»</option>
										<option value="è³¼ç‰©">è³¼ç‰©</option>
										<option value="ä½å®¿">ä½å®¿</option>
										<option value="å…¶ä»–" selected>å…¶ä»–</option>
									</select>
								</label>
								<label class="full">
									é …ç›®
									<input name="item" type="text" placeholder="ä¾‹ï¼šé»‘é–€å¸‚å ´ ç”Ÿè ”" required />
								</label>
								<label>
									å¹£åˆ¥
									<select name="currency" required>
										<option value="JPY" selected>JPYï¼ˆæ—¥åœ“ï¼‰</option>
										<option value="TWD">TWDï¼ˆå°å¹£ï¼‰</option>
									</select>
								</label>
								<label>
									é‡‘é¡
									<input name="amount" type="number" inputmode="decimal" min="0" step="0.01" required />
								</label>
								<div class="full" style="display:flex; gap:10px;">
									<button class="btn primary" type="submit" style="flex:1;">â• æ–°å¢</button>
									<button class="btn danger" id="ledgerClear" type="button" style="flex:1;">æ¸…é™¤å…¨éƒ¨</button>
								</div>
							</form>

							<div id="ledgerSummary"></div>
							<div style="overflow:auto;">
								<table class="table" aria-label="è¨˜å¸³è¡¨">
									<thead>
										<tr>
											<th>æ—¥æœŸ</th>
											<th>é¡åˆ¥</th>
											<th>é …ç›®</th>
											<th class="right">é‡‘é¡</th>
											<th></th>
										</tr>
									</thead>
									<tbody id="ledgerBody"></tbody>
								</table>
							</div>
						</div>

						<div class="small">è¨˜å¸³è³‡æ–™æœƒå„²å­˜åœ¨æœ¬æ©Ÿç€è¦½å™¨ï¼ˆlocalStorageï¼‰ï¼Œä¸æœƒä¸Šå‚³ã€‚</div>
					</section>
				`;

				wireHotelBooking();
				wireLedger(ledgerRows);
			}

			function wireHotelBooking() {
				const state = loadHotelBooking();
				const inputs = document.querySelectorAll("[data-hotel-idx][data-hotel-field]");
				inputs.forEach((input) => {
					input.addEventListener("input", () => {
						const idx = String(input.getAttribute("data-hotel-idx") || "");
						const field = String(input.getAttribute("data-hotel-field") || "");
						if (!idx) return;
						if (field !== "orderNo" && field !== "pin") return;
						state[idx] = state[idx] && typeof state[idx] === "object" ? state[idx] : {};
						state[idx][field] = String(input.value || "");
						saveHotelBooking(state);
					});
				});
			}

			function computeLedgerSummary(rows) {
				const byCurrency = new Map();
				const byCatCurrency = new Map();
				for (const r of rows) {
					const amount = Number(r.amount || 0);
					const cur = r.currency || "JPY";
					const cat = r.category || "å…¶ä»–";

					byCurrency.set(cur, (byCurrency.get(cur) || 0) + amount);
					const key = `${cat}__${cur}`;
					byCatCurrency.set(key, (byCatCurrency.get(key) || 0) + amount);
				}
				return { byCurrency, byCatCurrency };
			}

			function renderLedgerTable(rows) {
				const body = document.getElementById("ledgerBody");
				body.innerHTML = "";

				rows
					.slice()
					.sort((a, b) => (a.date || "").localeCompare(b.date || ""))
					.forEach((r, idx) => {
						const tr = document.createElement("tr");
						tr.innerHTML = `
							<td>${escapeHtml(r.date || "-")}</td>
							<td>${escapeHtml(r.category || "-")}</td>
							<td>${escapeHtml(r.item || "-")}</td>
							<td class="right">${escapeHtml(r.currency || "")}&nbsp;${escapeHtml(
								money(Number(r.amount || 0))
							)}</td>
							<td class="right"><button class="btn danger" data-del="${escapeHtml(
								String(idx)
							)}" type="button">åˆªé™¤</button></td>
						`;
						body.appendChild(tr);
					});
			}

			function renderLedgerSummary(rows) {
				const el = document.getElementById("ledgerSummary");
				const { byCurrency, byCatCurrency } = computeLedgerSummary(rows);

				const currencies = Array.from(byCurrency.keys()).sort();
				const totalsLine = currencies
					.map((c) => `${c} ${money(byCurrency.get(c) || 0)}`)
					.join("ï½œ");

				const cats = ["äº¤é€š", "é¤é£²", "æ™¯é»", "è³¼ç‰©", "ä½å®¿", "å…¶ä»–"];
				const breakdown = cats
					.map((cat) => {
						const parts = currencies
							.map((cur) => {
								const v = byCatCurrency.get(`${cat}__${cur}`) || 0;
								return v ? `${cur} ${money(v)}` : null;
							})
							.filter(Boolean)
							.join(" / ");
						if (!parts) return null;
						return `<div class="line"><div class="k">${escapeHtml(
							cat
						)}</div><div class="v">${escapeHtml(parts)}</div></div>`;
					})
					.filter(Boolean)
					.join("");

				el.innerHTML = `
					<div class="kv" style="margin-top:0;">
						<div class="line"><div class="k">ç¸½æ”¯å‡º</div><div class="v">${escapeHtml(
							totalsLine || "-"
						)}</div></div>
						${breakdown}
					</div>
				`;
			}

			function wireLedger(initialRows) {
				let rows = initialRows.slice();

				const form = document.getElementById("ledgerForm");
				const clearBtn = document.getElementById("ledgerClear");
				const body = document.getElementById("ledgerBody");

				const rerender = () => {
					saveLedger(rows);
					renderLedgerSummary(rows);
					renderLedgerTable(rows);
				};

				rerender();

				form.addEventListener("submit", (e) => {
					e.preventDefault();
					const fd = new FormData(form);
					const row = {
						date: String(fd.get("date") || "").trim(),
						category: String(fd.get("category") || "å…¶ä»–").trim(),
						item: String(fd.get("item") || "").trim(),
						currency: String(fd.get("currency") || "JPY").trim(),
						amount: Number(fd.get("amount") || 0),
					};

					if (!row.date || !row.item || !(row.amount >= 0)) return;
					rows.push(row);
					form.reset();
					rerender();
				});

				clearBtn.addEventListener("click", () => {
					const ok = confirm("ç¢ºå®šæ¸…é™¤å…¨éƒ¨è¨˜å¸³è³‡æ–™ï¼Ÿï¼ˆæ­¤å‹•ä½œç„¡æ³•å¾©åŸï¼‰");
					if (!ok) return;
					rows = [];
					rerender();
				});

				body.addEventListener("click", (e) => {
					const btn = e.target.closest("button[data-del]");
					if (!btn) return;
					const idx = Number(btn.getAttribute("data-del"));
					if (!Number.isFinite(idx)) return;
					rows.splice(idx, 1);
					rerender();
				});
			}

			// === App init ===
			function buildDays(items) {
				const byDate = new Map();
				for (const it of items) {
					const md = it["æ—¥æœŸ"];
					if (!byDate.has(md)) byDate.set(md, []);
					byDate.get(md).push(it);
				}
				const dates = Array.from(byDate.keys()).sort((a, b) => {
					const da = parseMonthDay(a);
					const db = parseMonthDay(b);
					return da - db;
				});
				return dates.map((md, i) => {
					const city = DAY_PRIMARY_CITY[md] || "äº¬éƒ½";
					const dayIndex = i + 1;
					const its = byDate.get(md).slice().sort((a, b) => (a["æ™‚é–“"] || "").localeCompare(b["æ™‚é–“"] || ""));
					const summary = `${its.length} å€‹è¡Œç¨‹`;
					return { md, city, dayIndex, items: its, summary };
				});
			}

			function setPage(page) {
				const isDaily = page === "daily";
				const isFood = page === "food";
				const isTools = page === "tools";
				document.getElementById("page-daily").setAttribute("aria-hidden", isDaily ? "false" : "true");
				document.getElementById("page-food").setAttribute("aria-hidden", isFood ? "false" : "true");
				document.getElementById("page-tools").setAttribute("aria-hidden", isTools ? "false" : "true");
				document.getElementById("tab-daily").setAttribute("aria-selected", isDaily ? "true" : "false");
				document.getElementById("tab-food").setAttribute("aria-selected", isFood ? "true" : "false");
				document.getElementById("tab-tools").setAttribute("aria-selected", isTools ? "true" : "false");
			}

			function init() {
				const now = new Date();
				document.getElementById("nowHint").textContent = `ä»Šå¤©ï¼š${now.toLocaleDateString("zh-TW")}`;

				const items = parseCSV(ITINERARY_CSV);
				const days = buildDays(items);
				DAYS_CACHE = days;
				const selected = getDefaultSelectedDay(days);
				renderDayTabs(days, selected);
				renderDaily(days, selected);

				FOOD_NOTES_CACHE = loadFoodNotes();
				FOOD_PINNED_CACHE = loadFoodPinned();
				FOOD_PINNED_ORDER_CACHE = loadFoodPinnedOrder();
				const foodRaw = parseCSV(FOOD_CSV)
					.map(normalizeFoodItem)
					.filter((x) => (x.title || x.url) && x.title !== "â€”");
				const foodItems = dedupeFoodItems(foodRaw).map((x) => ({ ...x, place: inferFoodPlace(x) }));
				FOOD_ITEMS_CACHE = foodItems;
				FOOD_PLACE_SELECTED = loadFoodPlaceDefault();
				renderFoodPlaceTabs(FOOD_PLACE_SELECTED);
				renderFood(foodItems, FOOD_PLACE_SELECTED);
				wireFoodNotes();
				wireFoodPinned();
				wirePinnedSort();

				const ledgerRows = loadLedger();
				renderTools(ledgerRows);

				document.getElementById("tab-daily").addEventListener("click", () => setPage("daily"));
				document.getElementById("tab-food").addEventListener("click", () => setPage("food"));
				document.getElementById("tab-tools").addEventListener("click", () => setPage("tools"));
			}

			init();
		</script>
	</body>
</html>

